"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.inspectorChainWebpack = void 0;
const webpack_1 = require("webpack");
const inspector_plugin_1 = require("./inspector-plugin");
const inspectorChainWebpack = (config, inspectorConfig) => {
    /**
     * [compile time] for inject source code file info
     */
    config
        .module
        .rule('inspector')
        .enforce('pre')
        .test(/\.[jt]sx$/)
        .exclude
        .add(/node_modules/)
        .add(/\.umi(-production)?\//)
        .add(/\/devTools\//)
        .add(/\.storybook\//)
        .end()
        .use('inspector')
        .loader(require.resolve('./inspector-loader'))
        .options(inspectorConfig !== null && inspectorConfig !== void 0 ? inspectorConfig : {})
        .end();
    /**
     * [compile time] used in web page runtime
     */
    config
        .plugin('define-pwd')
        .use(webpack_1.DefinePlugin, [
        {
            'process.env.PWD': JSON.stringify(process.cwd()),
        },
    ])
        .end();
    /**
     * [server side] add webpack dev server middleware for launch IDE app with api request
     */
    config
        .plugin('react-inspector')
        .use(inspector_plugin_1.ReactInspectorPlugin, []);
    return config;
};
exports.inspectorChainWebpack = inspectorChainWebpack;
