{"version":3,"sources":["../../src/control/layer.ts"],"names":["PositionType","bindAll","DOM","Control","Layers","cfg","layerControlInputs","layers","lastZIndex","handlingClick","layersLink","baseLayersList","separator","overlaysList","form","initLayers","collapsed","position","TOPRIGHT","autoZIndex","hideSingleBase","sortLayers","name","initLayout","update","mapsService","on","checkDisabledLayers","forEach","layerItem","layer","onLayerChange","container","addLayer","renderService","getViewportSize","height","addClass","style","acceptableHeight","offsetTop","clientHeight","removeClass","off","collapse","className","create","controlOption","setAttribute","addEventListener","expand","link","title","appendChild","baseLayers","overlayers","Object","keys","index","empty","baseLayersPresent","overlaysPresent","i","obj","baseLayersCount","length","addItem","overlay","display","inputs","input","zoom","getZoom","layerService","getLayer","layerId","inited","minZoom","getMinZoom","maxZoom","getMaxZoom","disabled","push","sortFunction","sort","a","b","setZIndex","expandIfNotCollapsed","e","target","type","emit","checked","radioHtml","radioFragment","document","createElement","innerHTML","firstChild","label","id","isVisible","defaultChecked","createRadioElement","onInputClick","holder","addedLayers","removedLayers","l","hide","show"],"mappings":"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","sourcesContent":["import { IControlOption, PositionName, PositionType } from '@antv/l7-core';\nimport { bindAll, DOM, lnglatDistance } from '@antv/l7-utils';\nimport Control from './BaseControl';\nexport interface ILayerControlOption extends IControlOption {\n  collapsed: boolean;\n  autoZIndex: boolean;\n  hideSingleBase: boolean;\n  sortLayers: boolean;\n\n  sortFunction: (...args: any[]) => any;\n}\ninterface IInputItem extends HTMLInputElement {\n  layerId: string;\n}\nexport default class Layers extends Control {\n  private layerControlInputs: any[];\n  private layers: any[];\n  private lastZIndex: number;\n  private handlingClick: boolean;\n  private layersLink: HTMLElement;\n  private baseLayersList: HTMLElement;\n  private separator: HTMLElement;\n  private overlaysList: HTMLElement;\n  private form: HTMLElement;\n\n  constructor(cfg: Partial<ILayerControlOption>) {\n    super(cfg);\n    this.layerControlInputs = [];\n    this.layers = [];\n    this.lastZIndex = 0;\n    this.handlingClick = false;\n    this.initLayers();\n\n    bindAll(\n      [\n        'checkDisabledLayers',\n        'onLayerChange',\n        'collapse',\n        'extend',\n        'expand',\n        'onInputClick',\n      ],\n      this,\n    );\n  }\n\n  public getDefault() {\n    return {\n      collapsed: true,\n      position: PositionType.TOPRIGHT,\n      autoZIndex: true,\n      hideSingleBase: false,\n      sortLayers: false,\n      name: 'layers',\n    };\n  }\n  public onAdd() {\n    this.initLayout();\n    this.update();\n    this.mapsService.on('zoomend', this.checkDisabledLayers);\n    this.layers.forEach((layerItem) => {\n      layerItem.layer.on('remove', this.onLayerChange);\n      layerItem.layer.on('add', this.onLayerChange);\n    });\n    return this.container;\n  }\n\n  public addVisualLayer(layer: any, name: string | number) {\n    this.addLayer(layer, name, true);\n    return this.mapsService ? this.update() : this;\n  }\n  public expand() {\n    const { height } = this.renderService.getViewportSize();\n    DOM.addClass(this.container, 'l7-control-layers-expanded');\n    this.form.style.height = 'null';\n    const acceptableHeight = height - (this.container.offsetTop + 50);\n    if (acceptableHeight < this.form.clientHeight) {\n      DOM.addClass(this.form, 'l7-control-layers-scrollbar');\n      this.form.style.height = acceptableHeight + 'px';\n    } else {\n      DOM.removeClass(this.form, 'l7-control-layers-scrollbar');\n    }\n    this.checkDisabledLayers();\n    return this;\n  }\n\n  public collapse() {\n    DOM.removeClass(this.container, 'l7-control-layers-expanded');\n    return this;\n  }\n\n  public onRemove() {\n    if (!this.mapsService) {\n      return;\n    }\n    this.mapsService.off('click', this.collapse);\n    this.layers.forEach((layerItem) => {\n      layerItem.layer.off('remove', this.onLayerChange);\n      layerItem.layer.off('add', this.onLayerChange);\n    });\n  }\n  private initLayout() {\n    const className = 'l7-control-layers';\n    const container = (this.container = DOM.create('div', className));\n    const { collapsed } = this.controlOption;\n    // makes this work on IE touch devices by stopping it from firing a mouseout event when the touch is released\n    container.setAttribute('aria-haspopup', 'true');\n    const form = (this.form = DOM.create(\n      'form',\n      className + '-list',\n    ) as HTMLElement);\n\n    if (collapsed) {\n      this.mapsService.on('click', this.collapse);\n      container.addEventListener('mouseenter', this.expand);\n      container.addEventListener('mouseleave', this.collapse);\n    }\n\n    this.layersLink = DOM.create('a', className + '-toggle', container);\n    const link = this.layersLink;\n    // link.href = '#';\n    link.title = 'Layers';\n    if (!collapsed) {\n      this.expand();\n    }\n    this.baseLayersList = DOM.create('div', className + '-base', form);\n    this.separator = DOM.create('div', className + '-separator', form);\n    this.overlaysList = DOM.create('div', className + '-overlays', form);\n    container.appendChild(form);\n  }\n  private initLayers() {\n    const { baseLayers = {}, overlayers = {} } = this.controlOption;\n    Object.keys(baseLayers).forEach((name: string, index: number) => {\n      // baseLayers[name].once('inited', this.update);\n      this.addLayer(baseLayers[name], name, false);\n    });\n    Object.keys(overlayers).forEach((name: any, index: number) => {\n      // overlayers[name].once('inited', this.update);\n      this.addLayer(overlayers[name], name, true);\n    });\n  }\n\n  private update() {\n    if (!this.container) {\n      return this;\n    }\n\n    DOM.empty(this.baseLayersList);\n    DOM.empty(this.overlaysList);\n\n    this.layerControlInputs = [];\n    let baseLayersPresent;\n    let overlaysPresent;\n    let i;\n    let obj;\n    let baseLayersCount = 0;\n\n    for (i = 0; i < this.layers.length; i++) {\n      obj = this.layers[i];\n      this.addItem(obj);\n      overlaysPresent = overlaysPresent || obj.overlay;\n      baseLayersPresent = baseLayersPresent || !obj.overlay;\n      baseLayersCount += !obj.overlay ? 1 : 0;\n    }\n\n    // Hide base layers section if there's only one layer.\n    if (this.controlOption.hideSingleBase) {\n      baseLayersPresent = baseLayersPresent && baseLayersCount > 1;\n      this.baseLayersList.style.display = baseLayersPresent ? '' : 'none';\n    }\n\n    this.separator.style.display =\n      overlaysPresent && baseLayersPresent ? '' : 'none';\n\n    return this;\n  }\n\n  private checkDisabledLayers() {\n    const inputs = this.layerControlInputs;\n    let input: IInputItem;\n    let layer;\n    const zoom = this.mapsService.getZoom();\n\n    for (let i = inputs.length - 1; i >= 0; i--) {\n      input = inputs[i];\n      layer = this.layerService.getLayer(input.layerId);\n\n      if (layer && layer.inited) {\n        const minZoom = layer.getMinZoom();\n        const maxZoom = layer.getMaxZoom();\n\n        input.disabled = zoom < minZoom || zoom > maxZoom;\n      }\n    }\n  }\n\n  private addLayer(layer: any, name: string | number, overlay: boolean) {\n    if (this.mapsService) {\n      layer.on('add', this.onLayerChange);\n      layer.on('remove', this.onLayerChange);\n    }\n    this.layers.push({\n      layer,\n      name,\n      overlay,\n    });\n    const { sortLayers, sortFunction, autoZIndex } = this.controlOption;\n    if (sortLayers) {\n      this.layers.sort((a, b) => {\n        return sortFunction(a.layer, b.layer, a.name, b.name);\n      });\n    }\n\n    if (autoZIndex && layer.setZIndex) {\n      this.lastZIndex++;\n      layer.setZIndex(this.lastZIndex);\n    }\n\n    this.expandIfNotCollapsed();\n  }\n\n  private expandIfNotCollapsed() {\n    if (this.mapsService && !this.controlOption.collapsed) {\n      this.expand();\n    }\n    return this;\n  }\n\n  private onLayerChange(e: any) {\n    if (!this.handlingClick) {\n      this.update();\n    }\n\n    const obj = this.layerService.getLayer(e.target.layerId);\n\n    // @ts-ignore\n    const type = obj?.overlay\n      ? e.type === 'add'\n        ? 'overlayadd'\n        : 'overlayremove'\n      : e.type === 'add'\n      ? 'baselayerchange'\n      : null;\n\n    if (type) {\n      this.emit(type, obj);\n    }\n  }\n\n  private createRadioElement(name: string, checked: boolean): ChildNode {\n    const radioHtml =\n      '<input type=\"radio\" class=\"l7-control-layers-selector\" name=\"' +\n      name +\n      '\"' +\n      (checked ? ' checked=\"checked\"' : '') +\n      '/>';\n\n    const radioFragment = document.createElement('div');\n    radioFragment.innerHTML = radioHtml;\n\n    return radioFragment.firstChild as ChildNode;\n  }\n\n  private addItem(obj: any) {\n    const label = document.createElement('label');\n    const layer = this.layerService.getLayer(obj.layer.id);\n    const checked = layer && layer.inited && obj.layer.isVisible();\n    let input: IInputItem;\n    if (obj.overlay) {\n      input = document.createElement('input') as IInputItem;\n      input.type = 'checkbox';\n      input.className = 'l7-control-layers-selector';\n      input.defaultChecked = checked;\n    } else {\n      input = this.createRadioElement('l7-base-layers', checked) as IInputItem;\n    }\n    this.layerControlInputs.push(input);\n    input.layerId = obj.layer.id;\n    input.addEventListener('click', this.onInputClick);\n\n    const name = document.createElement('span');\n    name.innerHTML = ' ' + obj.name;\n\n    const holder = document.createElement('div');\n\n    label.appendChild(holder);\n    holder.appendChild(input);\n    holder.appendChild(name);\n\n    const container = obj.overlay ? this.overlaysList : this.baseLayersList;\n    container.appendChild(label);\n\n    this.checkDisabledLayers();\n    return label;\n  }\n\n  private onInputClick() {\n    const inputs = this.layerControlInputs;\n    let input;\n    let layer;\n    const addedLayers = [];\n    const removedLayers = [];\n    this.handlingClick = true;\n    for (let i = inputs.length - 1; i >= 0; i--) {\n      input = inputs[i];\n      layer = this.layerService.getLayer(input.layerId);\n      if (input.checked) {\n        addedLayers.push(layer);\n      } else if (!input.checked) {\n        removedLayers.push(layer);\n      }\n    }\n    removedLayers.forEach((l: any) => {\n      l.hide();\n    });\n    addedLayers.forEach((l: any) => {\n      l.show();\n    });\n\n    this.handlingClick = false;\n  }\n}\n"],"file":"layer.js"}