{"version":3,"sources":["../../../src/handler/mouse/mouse_handler.ts"],"names":["MouseHandler","options","enabled","active","lastPoint","eventButton","moved","clickTolerance","reset","e","point","DOM","mouseButton","correctButton","preventDefault","dist","move","suppressClick","button"],"mappings":";;;;;;;;;;;;;AAEA;;AACA;;IACqBA,Y;AAQnB,wBAAYC,OAAZ,EAAiD;AAAA;AAAA,SAPvCC,OAOuC;AAAA,SANvCC,MAMuC;AAAA,SALvCC,SAKuC;AAAA,SAJvCC,WAIuC;AAAA,SAHvCC,KAGuC;AAAA,SAFvCC,cAEuC;AAC/C,SAAKC,KAAL;AACA,SAAKD,cAAL,GAAsBN,OAAO,CAACM,cAAR,IAA0B,CAAhD;AACD;;;;WAED,iBAAe;AACb,WAAKJ,MAAL,GAAc,KAAd;AACA,WAAKG,KAAL,GAAa,KAAb;AACA,aAAO,KAAKF,SAAZ;AACA,aAAO,KAAKC,WAAZ;AACD;;;WAED,mBAAiBI,CAAjB,EAAgCC,KAAhC,EAA8C;AAC5C,UAAI,KAAKN,SAAT,EAAoB;AAClB;AACD;;AAED,UAAMC,WAAW,GAAGM,aAAIC,WAAJ,CAAgBH,CAAhB,CAApB;;AACA,UAAI,CAAC,KAAKI,aAAL,CAAmBJ,CAAnB,EAAsBJ,WAAtB,CAAL,EAAyC;AACvC;AACD;;AAED,WAAKD,SAAL,GAAiBM,KAAjB;AACA,WAAKL,WAAL,GAAmBA,WAAnB;AACD;;;WAED,yBAAuBI,CAAvB,EAAsCC,KAAtC,EAAoD;AAClD,UAAMN,SAAS,GAAG,KAAKA,SAAvB;;AACA,UAAI,CAACA,SAAL,EAAgB;AACd;AACD;;AACDK,MAAAA,CAAC,CAACK,cAAF;;AAEA,UAAI,8BAAmBL,CAAnB,EAAsB,KAAKJ,WAA3B,CAAJ,EAA6C;AAO3C,aAAKG,KAAL;AACA;AACD;;AAED,UAAI,CAAC,KAAKF,KAAN,IAAeI,KAAK,CAACK,IAAN,CAAWX,SAAX,IAAwB,KAAKG,cAAhD,EAAgE;AAC9D;AACD;;AACD,WAAKD,KAAL,GAAa,IAAb;AACA,WAAKF,SAAL,GAAiBM,KAAjB;AAGA,aAAO,KAAKM,IAAL,CAAUZ,SAAV,EAAqBM,KAArB,CAAP;AACD;;;WAED,uBAAqBD,CAArB,EAAoC;AAClC,UAAI,CAAC,KAAKL,SAAV,EAAqB;AACnB;AACD;;AACD,UAAMC,WAAW,GAAGM,aAAIC,WAAJ,CAAgBH,CAAhB,CAApB;;AACA,UAAIJ,WAAW,KAAK,KAAKA,WAAzB,EAAsC;AACpC;AACD;;AACD,UAAI,KAAKC,KAAT,EAAgB;AACdK,qBAAIM,aAAJ;AACD;;AACD,WAAKT,KAAL;AACD;;;WAED,kBAAgB;AACd,WAAKN,OAAL,GAAe,IAAf;AACD;;;WAED,mBAAiB;AACf,WAAKA,OAAL,GAAe,KAAf;AACA,WAAKM,KAAL;AACD;;;WAED,qBAAmB;AACjB,aAAO,KAAKN,OAAZ;AACD;;;WAED,oBAAkB;AAChB,aAAO,KAAKC,MAAZ;AACD;;;WAED,uBAAwBM,CAAxB,EAAuCS,MAAvC,EAAuD;AAErD,aAAO,KAAP;AACD;;;WAED,cAAed,SAAf,EAAiCM,KAAjC,EAA+C;AAE7C;AACD","sourcesContent":["// @ts-ignore\nimport Point from '../../geo/point';\nimport DOM from '../../utils/dom';\nimport { buttonStillPressed } from './util';\nexport default class MouseHandler {\n  protected enabled: boolean;\n  protected active: boolean;\n  protected lastPoint: Point;\n  protected eventButton: 1 | 2;\n  protected moved: boolean;\n  protected clickTolerance: number;\n\n  constructor(options: { clickTolerance: number }) {\n    this.reset();\n    this.clickTolerance = options.clickTolerance || 1;\n  }\n\n  public reset() {\n    this.active = false;\n    this.moved = false;\n    delete this.lastPoint;\n    delete this.eventButton;\n  }\n\n  public mousedown(e: MouseEvent, point: Point) {\n    if (this.lastPoint) {\n      return;\n    }\n\n    const eventButton = DOM.mouseButton(e);\n    if (!this.correctButton(e, eventButton)) {\n      return;\n    }\n\n    this.lastPoint = point;\n    this.eventButton = eventButton;\n  }\n\n  public mousemoveWindow(e: MouseEvent, point: Point) {\n    const lastPoint = this.lastPoint;\n    if (!lastPoint) {\n      return;\n    }\n    e.preventDefault();\n\n    if (buttonStillPressed(e, this.eventButton)) {\n      // Some browsers don't fire a `mouseup` when the mouseup occurs outside\n      // the window or iframe:\n      // https://github.com/mapbox/mapbox-gl-js/issues/4622\n      //\n      // If the button is no longer pressed during this `mousemove` it may have\n      // been released outside of the window or iframe.\n      this.reset();\n      return;\n    }\n\n    if (!this.moved && point.dist(lastPoint) < this.clickTolerance) {\n      return;\n    }\n    this.moved = true;\n    this.lastPoint = point;\n\n    // implemented by child class\n    return this.move(lastPoint, point);\n  }\n\n  public mouseupWindow(e: MouseEvent) {\n    if (!this.lastPoint) {\n      return;\n    }\n    const eventButton = DOM.mouseButton(e);\n    if (eventButton !== this.eventButton) {\n      return;\n    }\n    if (this.moved) {\n      DOM.suppressClick();\n    }\n    this.reset();\n  }\n\n  public enable() {\n    this.enabled = true;\n  }\n\n  public disable() {\n    this.enabled = false;\n    this.reset();\n  }\n\n  public isEnabled() {\n    return this.enabled;\n  }\n\n  public isActive() {\n    return this.active;\n  }\n\n  protected correctButton(e: MouseEvent, button: number) {\n    // eslint-disable-line\n    return false; // implemented by child\n  }\n\n  protected move(lastPoint: Point, point: Point) {\n    // eslint-disable-line\n    return; // implemented by child\n  }\n}\n"],"file":"mouse_handler.js"}