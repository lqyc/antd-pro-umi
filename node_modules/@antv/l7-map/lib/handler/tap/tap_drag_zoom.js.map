{"version":3,"sources":["../../../src/handler/tap/tap_drag_zoom.ts"],"names":["TapDragZoomHandler","enabled","active","swipePoint","swipeTouch","tapTime","tap","TapRecognizer","numTouches","numTaps","reset","e","points","mapTouches","timeStamp","MAX_TAP_INTERVAL","touchstart","length","identifier","touchmove","newSwipePoint","dist","y","preventDefault","zoomDelta","point","touchend"],"mappings":";;;;;;;;;;;;;AAEA;;AACA;;IAEqBA,kB;AAQnB,gCAAc;AAAA;AAAA,SAPPC,OAOO;AAAA,SANPC,MAMO;AAAA,SALPC,UAKO;AAAA,SAJPC,UAIO;AAAA,SAHPC,OAGO;AAAA,SAFPC,GAEO;AACZ,SAAKA,GAAL,GAAW,IAAIC,uBAAJ,CAAkB;AAC3BC,MAAAA,UAAU,EAAE,CADe;AAE3BC,MAAAA,OAAO,EAAE;AAFkB,KAAlB,CAAX;AAKA,SAAKC,KAAL;AACD;;;;WAED,iBAAe;AACb,WAAKR,MAAL,GAAc,KAAd;AACA,aAAO,KAAKC,UAAZ;AACA,aAAO,KAAKC,UAAZ;AACA,aAAO,KAAKC,OAAZ;AACA,WAAKC,GAAL,CAASI,KAAT;AACD;;;WAED,oBAAkBC,CAAlB,EAAiCC,MAAjC,EAAkDC,UAAlD,EAAuE;AACrE,UAAI,KAAKV,UAAT,EAAqB;AACnB;AACD;;AAED,UAAI,KAAKE,OAAL,IAAgBM,CAAC,CAACG,SAAF,GAAc,KAAKT,OAAnB,GAA6BU,uCAAjD,EAAmE;AACjE,aAAKL,KAAL;AACD;;AAED,UAAI,CAAC,KAAKL,OAAV,EAAmB;AACjB,aAAKC,GAAL,CAASU,UAAT,CAAoBL,CAApB,EAAuBC,MAAvB,EAA+BC,UAA/B;AACD,OAFD,MAEO,IAAIA,UAAU,CAACI,MAAX,GAAoB,CAAxB,EAA2B;AAChC,aAAKd,UAAL,GAAkBS,MAAM,CAAC,CAAD,CAAxB;AACA,aAAKR,UAAL,GAAkBS,UAAU,CAAC,CAAD,CAAV,CAAcK,UAAhC;AACD;AACF;;;WAED,mBAAiBP,CAAjB,EAAgCC,MAAhC,EAAiDC,UAAjD,EAAsE;AACpE,UAAI,CAAC,KAAKR,OAAV,EAAmB;AACjB,aAAKC,GAAL,CAASa,SAAT,CAAmBR,CAAnB,EAAsBC,MAAtB,EAA8BC,UAA9B;AACD,OAFD,MAEO,IAAI,KAAKV,UAAT,EAAqB;AAC1B,YAAIU,UAAU,CAAC,CAAD,CAAV,CAAcK,UAAd,KAA6B,KAAKd,UAAtC,EAAkD;AAChD;AACD;;AAED,YAAMgB,aAAa,GAAGR,MAAM,CAAC,CAAD,CAA5B;AACA,YAAMS,IAAI,GAAGD,aAAa,CAACE,CAAd,GAAkB,KAAKnB,UAAL,CAAgBmB,CAA/C;AACA,aAAKnB,UAAL,GAAkBiB,aAAlB;AAEAT,QAAAA,CAAC,CAACY,cAAF;AACA,aAAKrB,MAAL,GAAc,IAAd;AAEA,eAAO;AACLsB,UAAAA,SAAS,EAAEH,IAAI,GAAG;AADb,SAAP;AAGD;AACF;;;WAED,kBAAgBV,CAAhB,EAA+BC,MAA/B,EAAgDC,UAAhD,EAAqE;AACnE,UAAI,CAAC,KAAKR,OAAV,EAAmB;AACjB,YAAMoB,KAAK,GAAG,KAAKnB,GAAL,CAASoB,QAAT,CAAkBf,CAAlB,EAAqBC,MAArB,EAA6BC,UAA7B,CAAd;;AACA,YAAIY,KAAJ,EAAW;AACT,eAAKpB,OAAL,GAAeM,CAAC,CAACG,SAAjB;AACD;AACF,OALD,MAKO,IAAI,KAAKX,UAAT,EAAqB;AAC1B,YAAIU,UAAU,CAACI,MAAX,KAAsB,CAA1B,EAA6B;AAC3B,eAAKP,KAAL;AACD;AACF;AACF;;;WAED,uBAAqB;AACnB,WAAKA,KAAL;AACD;;;WAED,kBAAgB;AACd,WAAKT,OAAL,GAAe,IAAf;AACD;;;WAED,mBAAiB;AACf,WAAKA,OAAL,GAAe,KAAf;AACA,WAAKS,KAAL;AACD;;;WAED,qBAAmB;AACjB,aAAO,KAAKT,OAAZ;AACD;;;WAED,oBAAkB;AAChB,aAAO,KAAKC,MAAZ;AACD","sourcesContent":["// @ts-ignore\nimport Point from '../../geo/point';\nimport { MAX_TAP_INTERVAL } from './single_tap_recognizer';\nimport TapRecognizer from './tap_recognizer';\n\nexport default class TapDragZoomHandler {\n  public enabled: boolean;\n  public active: boolean;\n  public swipePoint: Point;\n  public swipeTouch: number;\n  public tapTime: number;\n  public tap: TapRecognizer;\n\n  constructor() {\n    this.tap = new TapRecognizer({\n      numTouches: 1,\n      numTaps: 1,\n    });\n\n    this.reset();\n  }\n\n  public reset() {\n    this.active = false;\n    delete this.swipePoint;\n    delete this.swipeTouch;\n    delete this.tapTime;\n    this.tap.reset();\n  }\n\n  public touchstart(e: TouchEvent, points: Point[], mapTouches: Touch[]) {\n    if (this.swipePoint) {\n      return;\n    }\n\n    if (this.tapTime && e.timeStamp - this.tapTime > MAX_TAP_INTERVAL) {\n      this.reset();\n    }\n\n    if (!this.tapTime) {\n      this.tap.touchstart(e, points, mapTouches);\n    } else if (mapTouches.length > 0) {\n      this.swipePoint = points[0];\n      this.swipeTouch = mapTouches[0].identifier;\n    }\n  }\n\n  public touchmove(e: TouchEvent, points: Point[], mapTouches: Touch[]) {\n    if (!this.tapTime) {\n      this.tap.touchmove(e, points, mapTouches);\n    } else if (this.swipePoint) {\n      if (mapTouches[0].identifier !== this.swipeTouch) {\n        return;\n      }\n\n      const newSwipePoint = points[0];\n      const dist = newSwipePoint.y - this.swipePoint.y;\n      this.swipePoint = newSwipePoint;\n\n      e.preventDefault();\n      this.active = true;\n\n      return {\n        zoomDelta: dist / 128,\n      };\n    }\n  }\n\n  public touchend(e: TouchEvent, points: Point[], mapTouches: Touch[]) {\n    if (!this.tapTime) {\n      const point = this.tap.touchend(e, points, mapTouches);\n      if (point) {\n        this.tapTime = e.timeStamp;\n      }\n    } else if (this.swipePoint) {\n      if (mapTouches.length === 0) {\n        this.reset();\n      }\n    }\n  }\n\n  public touchcancel() {\n    this.reset();\n  }\n\n  public enable() {\n    this.enabled = true;\n  }\n\n  public disable() {\n    this.enabled = false;\n    this.reset();\n  }\n\n  public isEnabled() {\n    return this.enabled;\n  }\n\n  public isActive() {\n    return this.active;\n  }\n}\n"],"file":"tap_drag_zoom.js"}