{"version":3,"sources":["../src/camera.ts"],"names":["Camera","options","transform","moving","zooming","rotating","pitching","padding","bearingSnap","easeEndTimeoutID","easeStart","easeOptions","easeId","onEaseFrame","onEaseEnd","easeFrameId","renderFrameCallback","t","Math","min","duration","easing","requestRenderFrame","stop","minZoom","maxZoom","minPitch","maxPitch","renderWorldCopies","Transform","cb","_","center","lng","lat","LngLat","zoom","pitch","eventData","jumpTo","bearing","lnglat","easeTo","zoomTo","getZoom","rotateTo","bounds","fitInternal","cameraForBounds","LngLatBounds","convert","cameraForBoxAndBearing","getNorthWest","getSouthEast","abs","getBearing","resetNorth","tr","zoomChanged","bearingChanged","pitchChanged","undefined","isPaddingEqual","emit","Event","offset","defaultEasing","animate","essential","startZoom","startBearing","startPitch","getPitch","startPadding","getPadding","normalizeBearing","offsetAsPoint","Point","pointAtOffset","centerPoint","add","locationAtOffset","pointLocation","normalizeCenter","from","project","delta","sub","finalScale","zoomScale","around","aroundPoint","locationPoint","currently","prepareEase","noMoveStart","clearTimeout","ease","k","interpolatePadding","setLocationAtPoint","scale","base","max","speedup","pow","newCenter","unproject","mult","wrap","fireMoveEvents","interruptingEaseId","afterEase","coercedOptions","speed","curve","rho","w0","width","height","w1","u1","mag","wMax","sqrt","rho2","r","i","b","log","sinh","n","exp","cosh","tanh","r0","w","s","u","S","isFinite","V","screenSpeed","maxDuration","easeScale","scaleZoom","p0","p1","allowGestures","cancelRenderFrame","call","currentBearing","diff","lngRange","wasZooming","wasRotating","wasPitching","frame","finish","defaultPadding","top","bottom","right","left","p","edgePadding","p0world","p1world","p0rotated","rotate","PI","p1rotated","upperRight","x","y","lowerLeft","size","scaleX","scaleY","paddingOffsetX","paddingOffsetY","offsetAtInitialZoom","offsetAtFinalZoom","div","calculatedOptions","linear","flyTo","EventEmitter"],"mappings":"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","sourcesContent":["// @ts-ignore\nimport { EventEmitter } from 'eventemitter3';\nimport { merge } from 'lodash';\nimport { IPaddingOptions } from './geo/edge_insets';\nimport LngLat, { LngLatLike } from './geo/lng_lat';\nimport LngLatBounds, { LngLatBoundsLike } from './geo/lng_lat_bounds';\nimport Point, { PointLike } from './geo/point';\nimport Transform from './geo/transform';\nimport { Event } from './handler/events/event';\nimport { IMapOptions } from './interface';\ntype CallBack = (_: number) => void;\nimport {\n  cancel,\n  clamp,\n  ease as defaultEasing,\n  interpolate,\n  now,\n  pick,\n  prefersReducedMotion,\n  raf,\n  wrap,\n} from './util';\n\nexport interface ICameraOptions {\n  center?: LngLatLike;\n  zoom?: number;\n  bearing?: number;\n  pitch?: number;\n  around?: LngLatLike;\n  padding?: IPaddingOptions;\n}\n\nexport interface IAnimationOptions {\n  duration?: number;\n  easing?: (_: number) => number;\n  offset?: PointLike;\n  animate?: boolean;\n  essential?: boolean;\n  linear?: boolean;\n}\n\nexport default class Camera extends EventEmitter {\n  public transform: Transform;\n  // public requestRenderFrame: (_: any) => number;\n  // public cancelRenderFrame: (_: number) => void;\n  protected options: IMapOptions;\n  protected moving: boolean;\n  protected zooming: boolean;\n  protected rotating: boolean;\n  protected pitching: boolean;\n  protected padding: boolean;\n\n  private bearingSnap: number;\n  private easeEndTimeoutID: number;\n  private easeStart: number;\n  private easeOptions: {\n    duration: number;\n    easing: (_: number) => number;\n  };\n  private easeId: string | void;\n  private onEaseFrame: (_: number) => void;\n  private onEaseEnd: (easeId?: string) => void;\n  private easeFrameId: number;\n\n  constructor(options: IMapOptions) {\n    super();\n    this.options = options;\n    const { minZoom, maxZoom, minPitch, maxPitch, renderWorldCopies } = options;\n    this.moving = false;\n    this.zooming = false;\n    this.bearingSnap = options.bearingSnap;\n    this.transform = new Transform(\n      minZoom,\n      maxZoom,\n      minPitch,\n      maxPitch,\n      renderWorldCopies,\n    );\n  }\n  public requestRenderFrame(cb: CallBack): number {\n    return 0;\n  }\n  public cancelRenderFrame(_: number): void {\n    return;\n  }\n\n  public getCenter() {\n    const { lng, lat } = this.transform.center;\n    return new LngLat(lng, lat);\n  }\n\n  public getZoom(): number {\n    return this.transform.zoom;\n  }\n\n  public getPitch(): number {\n    return this.transform.pitch;\n  }\n\n  public setCenter(center: LngLatLike, eventData?: any) {\n    return this.jumpTo({ center }, eventData);\n  }\n\n  public setPitch(pitch: number, eventData?: any) {\n    this.jumpTo({ pitch }, eventData);\n    return this;\n  }\n\n  public getBearing(): number {\n    return this.transform.bearing;\n  }\n\n  public panTo(\n    lnglat: LngLatLike,\n    options?: IAnimationOptions,\n    eventData?: any,\n  ) {\n    return this.easeTo(\n      merge(\n        {\n          center: lnglat,\n        },\n        options,\n      ),\n      eventData,\n    );\n  }\n\n  public zoomOut(options?: IAnimationOptions, eventData?: any) {\n    this.zoomTo(this.getZoom() - 1, options, eventData);\n    return this;\n  }\n\n  public setBearing(bearing: number, eventData?: any) {\n    this.jumpTo({ bearing }, eventData);\n    return this;\n  }\n  public setZoom(zoom: number, eventData?: any) {\n    this.jumpTo({ zoom }, eventData);\n    return this;\n  }\n\n  public zoomIn(options?: IAnimationOptions, eventData?: any) {\n    this.zoomTo(this.getZoom() + 1, options, eventData);\n    return this;\n  }\n\n  public zoomTo(zoom: number, options?: IAnimationOptions, eventData?: any) {\n    return this.easeTo(\n      merge(\n        {\n          zoom,\n        },\n        options,\n      ),\n      eventData,\n    );\n  }\n\n  public getPadding(): IPaddingOptions {\n    return this.transform.padding;\n  }\n\n  public setPadding(padding: IPaddingOptions, eventData?: any) {\n    this.jumpTo({ padding }, eventData);\n    return this;\n  }\n\n  public rotateTo(\n    bearing: number,\n    options?: IAnimationOptions,\n    eventData?: any,\n  ) {\n    return this.easeTo(\n      merge(\n        {\n          bearing,\n        },\n        options,\n      ),\n      eventData,\n    );\n  }\n\n  public resetNorth(options?: IAnimationOptions, eventData?: any) {\n    this.rotateTo(0, merge({ duration: 1000 }, options), eventData);\n    return this;\n  }\n\n  public resetNorthPitch(options?: IAnimationOptions, eventData?: any) {\n    this.easeTo(\n      merge(\n        {\n          bearing: 0,\n          pitch: 0,\n          duration: 1000,\n        },\n        options,\n      ),\n      eventData,\n    );\n    return this;\n  }\n  public fitBounds(\n    bounds: LngLatBoundsLike,\n    options?: IAnimationOptions & ICameraOptions,\n    eventData?: any,\n  ) {\n    return this.fitInternal(\n      // @ts-ignore\n      this.cameraForBounds(bounds, options),\n      options,\n      eventData,\n    );\n  }\n  public cameraForBounds(\n    bounds: LngLatBoundsLike,\n    options?: ICameraOptions,\n  ): void | (ICameraOptions & IAnimationOptions) {\n    bounds = LngLatBounds.convert(bounds);\n    return this.cameraForBoxAndBearing(\n      bounds.getNorthWest(),\n      bounds.getSouthEast(),\n      0,\n      // @ts-ignore\n      options,\n    );\n  }\n\n  public snapToNorth(options?: IAnimationOptions, eventData?: any) {\n    if (Math.abs(this.getBearing()) < this.bearingSnap) {\n      return this.resetNorth(options, eventData);\n    }\n    return this;\n  }\n\n  public jumpTo(options: ICameraOptions = {}, eventData?: any) {\n    this.stop();\n\n    const tr = this.transform;\n    let zoomChanged = false;\n    let bearingChanged = false;\n    let pitchChanged = false;\n\n    if (options.zoom && tr.zoom !== +options.zoom) {\n      zoomChanged = true;\n      tr.zoom = +options.zoom;\n    }\n\n    if (options.center !== undefined) {\n      tr.center = LngLat.convert(options.center);\n    }\n\n    if (options.bearing && tr.bearing !== +options.bearing) {\n      bearingChanged = true;\n      tr.bearing = +options.bearing;\n    }\n\n    if (options.pitch && tr.pitch !== +options.pitch) {\n      pitchChanged = true;\n      tr.pitch = +options.pitch;\n    }\n\n    if (options.padding != null && !tr.isPaddingEqual(options.padding)) {\n      tr.padding = options.padding;\n    }\n\n    this.emit('movestart', new Event('movestart', eventData));\n    this.emit('move', new Event('move', eventData));\n\n    if (zoomChanged) {\n      this.emit('zoomstart', new Event('zoomstart', eventData));\n      this.emit('zoom', new Event('zoom', eventData));\n      this.emit('zoomend', new Event('zoomend', eventData));\n    }\n\n    if (bearingChanged) {\n      this.emit('rotatestart', new Event('rotatestart', eventData));\n      this.emit('rotate', new Event('rotate', eventData));\n      this.emit('rotateend', new Event('rotateend', eventData));\n    }\n\n    if (pitchChanged) {\n      this.emit('pitchstart', new Event('pitchstart', eventData));\n      this.emit('pitch', new Event('pitch', eventData));\n      this.emit('pitchend', new Event('pitchend', eventData));\n    }\n\n    return this.emit('moveend', new Event('moveend', eventData));\n  }\n\n  public easeTo(\n    options: ICameraOptions &\n      IAnimationOptions & { easeId?: string; noMoveStart?: boolean } = {},\n    eventData?: any,\n  ) {\n    options = merge(\n      {\n        offset: [0, 0],\n        duration: 500,\n        easing: defaultEasing,\n      },\n      options,\n    );\n\n    if (\n      options.animate === false ||\n      (!options.essential && prefersReducedMotion())\n    ) {\n      options.duration = 0;\n    }\n\n    const tr = this.transform;\n    const startZoom = this.getZoom();\n    const startBearing = this.getBearing();\n    const startPitch = this.getPitch();\n    const startPadding = this.getPadding();\n\n    const zoom = options.zoom ? +options.zoom : startZoom;\n    const bearing = options.bearing\n      ? this.normalizeBearing(options.bearing, startBearing)\n      : startBearing;\n    const pitch = options.pitch ? +options.pitch : startPitch;\n    const padding = options.padding ? options.padding : tr.padding;\n\n    const offsetAsPoint = Point.convert(options.offset);\n    let pointAtOffset = tr.centerPoint.add(offsetAsPoint);\n    const locationAtOffset = tr.pointLocation(pointAtOffset);\n    const center = LngLat.convert(options.center || locationAtOffset);\n    this.normalizeCenter(center);\n\n    const from = tr.project(locationAtOffset);\n    const delta = tr.project(center).sub(from);\n    const finalScale = tr.zoomScale(zoom - startZoom);\n\n    let around: LngLat;\n    let aroundPoint: Point;\n\n    if (options.around) {\n      around = LngLat.convert(options.around);\n      aroundPoint = tr.locationPoint(around);\n    }\n\n    const currently = {\n      moving: this.moving,\n      zooming: this.zooming,\n      rotating: this.rotating,\n      pitching: this.pitching,\n    };\n\n    this.zooming = this.zooming || zoom !== startZoom;\n    this.rotating = this.rotating || startBearing !== bearing;\n    this.pitching = this.pitching || pitch !== startPitch;\n    this.padding = !tr.isPaddingEqual(padding);\n\n    this.easeId = options.easeId;\n    this.prepareEase(eventData, options.noMoveStart, currently);\n\n    clearTimeout(this.easeEndTimeoutID);\n\n    this.ease(\n      (k) => {\n        if (this.zooming) {\n          tr.zoom = interpolate(startZoom, zoom, k);\n        }\n        if (this.rotating) {\n          tr.bearing = interpolate(startBearing, bearing, k);\n        }\n        if (this.pitching) {\n          tr.pitch = interpolate(startPitch, pitch, k);\n        }\n        if (this.padding) {\n          tr.interpolatePadding(startPadding, padding, k);\n          // When padding is being applied, Transform#centerPoint is changing continously,\n          // thus we need to recalculate offsetPoint every fra,e\n          pointAtOffset = tr.centerPoint.add(offsetAsPoint);\n        }\n\n        if (around) {\n          tr.setLocationAtPoint(around, aroundPoint);\n        } else {\n          const scale = tr.zoomScale(tr.zoom - startZoom);\n          const base =\n            zoom > startZoom\n              ? Math.min(2, finalScale)\n              : Math.max(0.5, finalScale);\n          const speedup = Math.pow(base, 1 - k);\n          const newCenter = tr.unproject(\n            from.add(delta.mult(k * speedup)).mult(scale),\n          );\n          tr.setLocationAtPoint(\n            tr.renderWorldCopies ? newCenter.wrap() : newCenter,\n            pointAtOffset,\n          );\n        }\n\n        this.fireMoveEvents(eventData);\n      },\n      (interruptingEaseId?: string) => {\n        this.afterEase(eventData, interruptingEaseId);\n      },\n      // @ts-ignore\n      options,\n    );\n\n    return this;\n  }\n  public flyTo(options: any = {}, eventData?: any) {\n    // Fall through to jumpTo if user has set prefers-reduced-motion\n    if (!options.essential && prefersReducedMotion()) {\n      const coercedOptions = pick(options, [\n        'center',\n        'zoom',\n        'bearing',\n        'pitch',\n        'around',\n      ]) as ICameraOptions;\n      return this.jumpTo(coercedOptions, eventData);\n    }\n\n    this.stop();\n\n    options = merge(\n      {\n        offset: [0, 0],\n        speed: 1.2,\n        curve: 1.42,\n        easing: defaultEasing,\n      },\n      options,\n    );\n    const tr = this.transform;\n    const startZoom = this.getZoom();\n    const startBearing = this.getBearing();\n    const startPitch = this.getPitch();\n    const startPadding = this.getPadding();\n\n    const zoom = options.zoom\n      ? clamp(+options.zoom, tr.minZoom, tr.maxZoom)\n      : startZoom;\n    const bearing = options.bearing\n      ? this.normalizeBearing(options.bearing, startBearing)\n      : startBearing;\n    const pitch = options.pitch ? +options.pitch : startPitch;\n    const padding = 'padding' in options ? options.padding : tr.padding;\n\n    const scale = tr.zoomScale(zoom - startZoom);\n    const offsetAsPoint = Point.convert(options.offset);\n    let pointAtOffset = tr.centerPoint.add(offsetAsPoint);\n    const locationAtOffset = tr.pointLocation(pointAtOffset);\n    const center = LngLat.convert(options.center || locationAtOffset);\n    this.normalizeCenter(center);\n\n    const from = tr.project(locationAtOffset);\n    const delta = tr.project(center).sub(from);\n\n    let rho = options.curve;\n\n    // w₀: Initial visible span, measured in pixels at the initial scale.\n    const w0 = Math.max(tr.width, tr.height);\n    // w₁: Final visible span, measured in pixels with respect to the initial scale.\n    const w1 = w0 / scale;\n    // Length of the flight path as projected onto the ground plane, measured in pixels from\n    // the world image origin at the initial scale.\n    const u1 = delta.mag();\n\n    if ('minZoom' in options) {\n      const minZoom = clamp(\n        Math.min(options.minZoom, startZoom, zoom),\n        tr.minZoom,\n        tr.maxZoom,\n      );\n      // w<sub>m</sub>: Maximum visible span, measured in pixels with respect to the initial\n      // scale.\n      const wMax = w0 / tr.zoomScale(minZoom - startZoom);\n      rho = Math.sqrt((wMax / u1) * 2);\n    }\n\n    // ρ²\n    const rho2 = rho * rho;\n\n    /**\n     * rᵢ: Returns the zoom-out factor at one end of the animation.\n     *\n     * @param i 0 for the ascent or 1 for the descent.\n     * @private\n     */\n    function r(i: number) {\n      const b =\n        (w1 * w1 - w0 * w0 + (i ? -1 : 1) * rho2 * rho2 * u1 * u1) /\n        (2 * (i ? w1 : w0) * rho2 * u1);\n      return Math.log(Math.sqrt(b * b + 1) - b);\n    }\n\n    function sinh(n: number) {\n      return (Math.exp(n) - Math.exp(-n)) / 2;\n    }\n    function cosh(n: number) {\n      return (Math.exp(n) + Math.exp(-n)) / 2;\n    }\n    function tanh(n: number) {\n      return sinh(n) / cosh(n);\n    }\n\n    // r₀: Zoom-out factor during ascent.\n    const r0 = r(0);\n\n    // w(s): Returns the visible span on the ground, measured in pixels with respect to the\n    // initial scale. Assumes an angular field of view of 2 arctan ½ ≈ 53°.\n    let w: (_: number) => number = (s) => {\n      return cosh(r0) / cosh(r0 + rho * s);\n    };\n\n    // u(s): Returns the distance along the flight path as projected onto the ground plane,\n    // measured in pixels from the world image origin at the initial scale.\n    let u: (_: number) => number = (s) => {\n      return (w0 * ((cosh(r0) * tanh(r0 + rho * s) - sinh(r0)) / rho2)) / u1;\n    };\n\n    // S: Total length of the flight path, measured in ρ-screenfuls.\n    let S = (r(1) - r0) / rho;\n\n    // When u₀ = u₁, the optimal path doesn’t require both ascent and descent.\n    if (Math.abs(u1) < 0.000001 || !isFinite(S)) {\n      // Perform a more or less instantaneous transition if the path is too short.\n      if (Math.abs(w0 - w1) < 0.000001) {\n        return this.easeTo(options, eventData);\n      }\n\n      const k = w1 < w0 ? -1 : 1;\n      S = Math.abs(Math.log(w1 / w0)) / rho;\n\n      u = () => {\n        return 0;\n      };\n      w = (s) => {\n        return Math.exp(k * rho * s);\n      };\n    }\n\n    if ('duration' in options) {\n      options.duration = +options.duration;\n    } else {\n      const V =\n        'screenSpeed' in options ? +options.screenSpeed / rho : +options.speed;\n      options.duration = (1000 * S) / V;\n    }\n\n    if (options.maxDuration && options.duration > options.maxDuration) {\n      options.duration = 0;\n    }\n\n    this.zooming = true;\n    this.rotating = startBearing !== bearing;\n    this.pitching = pitch !== startPitch;\n    this.padding = !tr.isPaddingEqual(padding);\n\n    this.prepareEase(eventData, false);\n\n    this.ease(\n      (k) => {\n        // s: The distance traveled along the flight path, measured in ρ-screenfuls.\n        const s = k * S;\n        // @ts-ignore\n        const easeScale = 1 / w(s);\n        tr.zoom = k === 1 ? zoom : startZoom + tr.scaleZoom(easeScale);\n\n        if (this.rotating) {\n          tr.bearing = interpolate(startBearing, bearing, k);\n        }\n        if (this.pitching) {\n          tr.pitch = interpolate(startPitch, pitch, k);\n        }\n        if (this.padding) {\n          tr.interpolatePadding(startPadding, padding, k);\n          // When padding is being applied, Transform#centerPoint is changing continously,\n          // thus we need to recalculate offsetPoint every frame\n          pointAtOffset = tr.centerPoint.add(offsetAsPoint);\n        }\n\n        const newCenter =\n          k === 1\n            ? center\n            : tr.unproject(from.add(delta.mult(u(s))).mult(easeScale));\n        tr.setLocationAtPoint(\n          tr.renderWorldCopies ? newCenter.wrap() : newCenter,\n          pointAtOffset,\n        );\n\n        this.fireMoveEvents(eventData);\n      },\n      () => this.afterEase(eventData),\n      options,\n    );\n\n    return this;\n  }\n  public fitScreenCoordinates(\n    p0: PointLike,\n    p1: PointLike,\n    bearing: number,\n    options?: IAnimationOptions & ICameraOptions,\n    eventData?: any,\n  ) {\n    return this.fitInternal(\n      // @ts-ignore\n      this.cameraForBoxAndBearing(\n        this.transform.pointLocation(Point.convert(p0)),\n        this.transform.pointLocation(Point.convert(p1)),\n        bearing,\n        // @ts-ignore\n        options,\n      ),\n      options,\n      eventData,\n    );\n  }\n  public stop(allowGestures?: boolean, easeId?: string) {\n    if (this.easeFrameId) {\n      this.cancelRenderFrame(this.easeFrameId);\n      delete this.easeFrameId;\n      delete this.onEaseFrame;\n    }\n\n    if (this.onEaseEnd) {\n      // The _onEaseEnd function might emit events which trigger new\n      // animation, which sets a new _onEaseEnd. Ensure we don't delete\n      // it unintentionally.\n      const onEaseEnd = this.onEaseEnd;\n      delete this.onEaseEnd;\n      onEaseEnd.call(this, easeId);\n    }\n    // if (!allowGestures) {\n    //     const handlers = (this: any).handlers;\n    //     if (handlers) handlers.stop();\n    // }\n    return this;\n  }\n  public renderFrameCallback = () => {\n    const t = Math.min((now() - this.easeStart) / this.easeOptions.duration, 1);\n    this.onEaseFrame(this.easeOptions.easing(t));\n    if (t < 1) {\n      // this.easeFrameId = window.requestAnimationFrame(this.renderFrameCallback);\n      this.easeFrameId = this.requestRenderFrame(this.renderFrameCallback);\n    } else {\n      this.stop();\n    }\n  };\n  private normalizeBearing(bearing: number, currentBearing: number) {\n    bearing = wrap(bearing, -180, 180);\n    const diff = Math.abs(bearing - currentBearing);\n    if (Math.abs(bearing - 360 - currentBearing) < diff) {\n      bearing -= 360;\n    }\n    if (Math.abs(bearing + 360 - currentBearing) < diff) {\n      bearing += 360;\n    }\n    return bearing;\n  }\n\n  private normalizeCenter(center: LngLat) {\n    const tr = this.transform;\n    if (!tr.renderWorldCopies || tr.lngRange) {\n      return;\n    }\n\n    const delta = center.lng - tr.center.lng;\n    center.lng += delta > 180 ? -360 : delta < -180 ? 360 : 0;\n  }\n\n  private fireMoveEvents(eventData?: any) {\n    this.emit('move', new Event('move', eventData));\n    if (this.zooming) {\n      this.emit('zoom', new Event('zoom', eventData));\n    }\n    if (this.rotating) {\n      this.emit('rotate', new Event('rotate', eventData));\n    }\n    if (this.pitching) {\n      this.emit('rotate', new Event('pitch', eventData));\n    }\n  }\n  private prepareEase(\n    eventData: object | undefined,\n    noMoveStart: boolean = false,\n    currently: { [key: string]: boolean } = {},\n  ) {\n    this.moving = true;\n\n    if (!noMoveStart && !currently.moving) {\n      this.emit('movestart', new Event('movestart', eventData));\n    }\n    if (this.zooming && !currently.zooming) {\n      this.emit('zoomstart', new Event('zoomstart', eventData));\n    }\n    if (this.rotating && !currently.rotating) {\n      this.emit('rotatestart', new Event('rotatestart', eventData));\n    }\n    if (this.pitching && !currently.pitching) {\n      this.emit('pitchstart', new Event('pitchstart', eventData));\n    }\n  }\n\n  private afterEase(eventData: object | undefined, easeId?: string) {\n    // if this easing is being stopped to start another easing with\n    // the same id then don't fire any events to avoid extra start/stop events\n    if (this.easeId && easeId && this.easeId === easeId) {\n      return;\n    }\n    delete this.easeId;\n\n    const wasZooming = this.zooming;\n    const wasRotating = this.rotating;\n    const wasPitching = this.pitching;\n    this.moving = false;\n    this.zooming = false;\n    this.rotating = false;\n    this.pitching = false;\n    this.padding = false;\n\n    if (wasZooming) {\n      this.emit('zoomend', new Event('zoomend', eventData));\n    }\n    if (wasRotating) {\n      this.emit('rotateend', new Event('rotateend', eventData));\n    }\n    if (wasPitching) {\n      this.emit('pitchend', new Event('pitchend', eventData));\n    }\n    this.emit('moveend', new Event('moveend', eventData));\n  }\n\n  private ease(\n    frame: (_: number) => void,\n    finish: () => void,\n    options: {\n      animate: boolean;\n      duration: number;\n      easing: (_: number) => number;\n    },\n  ) {\n    if (options.animate === false || options.duration === 0) {\n      frame(1);\n      finish();\n    } else {\n      this.easeStart = now();\n      this.easeOptions = options;\n      this.onEaseFrame = frame;\n      this.onEaseEnd = finish;\n      this.easeFrameId = this.requestRenderFrame(this.renderFrameCallback);\n    }\n  }\n\n  private cameraForBoxAndBearing(\n    p0: LngLatLike,\n    p1: LngLatLike,\n    bearing: number,\n    options?: ICameraOptions & {\n      offset: [number, number];\n      maxZoom: number;\n      padding: IPaddingOptions;\n    },\n  ): void | (ICameraOptions & IAnimationOptions) {\n    const defaultPadding = {\n      top: 0,\n      bottom: 0,\n      right: 0,\n      left: 0,\n    };\n    options = merge(\n      {\n        padding: defaultPadding,\n        offset: [0, 0],\n        maxZoom: this.transform.maxZoom,\n      },\n      options,\n    );\n\n    if (typeof options.padding === 'number') {\n      const p = options.padding;\n      options.padding = {\n        top: p,\n        bottom: p,\n        right: p,\n        left: p,\n      };\n    }\n\n    options.padding = merge(defaultPadding, options.padding);\n    const tr = this.transform;\n    const edgePadding = tr.padding as IPaddingOptions;\n\n    // We want to calculate the upper right and lower left of the box defined by p0 and p1\n    // in a coordinate system rotate to match the destination bearing.\n    const p0world = tr.project(LngLat.convert(p0));\n    const p1world = tr.project(LngLat.convert(p1));\n    const p0rotated = p0world.rotate((-bearing * Math.PI) / 180);\n    const p1rotated = p1world.rotate((-bearing * Math.PI) / 180);\n\n    const upperRight = new Point(\n      Math.max(p0rotated.x, p1rotated.x),\n      Math.max(p0rotated.y, p1rotated.y),\n    );\n    const lowerLeft = new Point(\n      Math.min(p0rotated.x, p1rotated.x),\n      Math.min(p0rotated.y, p1rotated.y),\n    );\n\n    // Calculate zoom: consider the original bbox and padding.\n    const size = upperRight.sub(lowerLeft);\n    const scaleX =\n      (tr.width -\n        // @ts-ignore\n        (edgePadding.left +\n          // @ts-ignore\n          edgePadding.right +\n          // @ts-ignore\n          options.padding.left +\n          // @ts-ignore\n          options.padding.right)) /\n      size.x;\n    const scaleY =\n      (tr.height -\n        // @ts-ignore\n        (edgePadding.top +\n          // @ts-ignore\n          edgePadding.bottom +\n          // @ts-ignore\n          options.padding.top +\n          // @ts-ignore\n          options.padding.bottom)) /\n      size.y;\n\n    if (scaleY < 0 || scaleX < 0) {\n      return;\n    }\n\n    const zoom = Math.min(\n      tr.scaleZoom(tr.scale * Math.min(scaleX, scaleY)),\n      options.maxZoom,\n    );\n\n    // Calculate center: apply the zoom, the configured offset, as well as offset that exists as a result of padding.\n    const offset = Point.convert(options.offset);\n    // @ts-ignore\n    const paddingOffsetX = (options.padding.left - options.padding.right) / 2;\n    // @ts-ignore\n    const paddingOffsetY = (options.padding.top - options.padding.bottom) / 2;\n    const offsetAtInitialZoom = new Point(\n      offset.x + paddingOffsetX,\n      offset.y + paddingOffsetY,\n    );\n    const offsetAtFinalZoom = offsetAtInitialZoom.mult(\n      tr.scale / tr.zoomScale(zoom),\n    );\n\n    const center = tr.unproject(\n      p0world\n        .add(p1world)\n        .div(2)\n        .sub(offsetAtFinalZoom),\n    );\n\n    return {\n      center,\n      zoom,\n      bearing,\n    };\n  }\n\n  private fitInternal(\n    calculatedOptions?: ICameraOptions & IAnimationOptions,\n    options?: IAnimationOptions & ICameraOptions,\n    eventData?: any,\n  ) {\n    // cameraForBounds warns + returns undefined if unable to fit:\n    if (!calculatedOptions) {\n      return this;\n    }\n\n    options = merge(calculatedOptions, options);\n    // Explictly remove the padding field because, calculatedOptions already accounts for padding by setting zoom and center accordingly.\n    delete options.padding;\n    // @ts-ignore\n    return options.linear\n      ? this.easeTo(options, eventData)\n      : this.flyTo(options, eventData);\n  }\n}\n"],"file":"camera.js"}