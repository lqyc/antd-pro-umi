{"version":3,"sources":["../../src/utils/dom.ts"],"names":["Point","DOM","create","tagName","className","container","el","window","document","createElement","undefined","appendChild","createNS","namespaceURI","createElementNS","docStyle","documentElement","style","testProp","props","i","selectProp","userSelect","disableDrag","enableDrag","transformProp","setTransform","value","passiveSupported","options","Object","defineProperty","get","addEventListener","removeEventListener","err","target","type","callback","capture","suppressClick","e","preventDefault","stopPropagation","setTimeout","mousePos","rect","getBoundingClientRect","clientX","left","clientLeft","clientY","top","clientTop","touchPos","touches","points","touche","push","mouseButton","InstallTrigger","button","ctrlKey","navigator","platform","toUpperCase","indexOf","remove","node","parentNode","removeChild"],"mappings":"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","sourcesContent":["// @ts-ignore\nimport Point from '../geo/point';\n\nconst DOM: {\n  [key: string]: (...arg: any[]) => any;\n} = {};\nexport default DOM;\n\nDOM.create = (tagName: string, className?: string, container?: HTMLElement) => {\n  const el = window.document.createElement(tagName);\n  if (className !== undefined) {\n    el.className = className;\n  }\n  if (container) {\n    container.appendChild(el);\n  }\n  return el;\n};\n\nDOM.createNS = (namespaceURI: string, tagName: string) => {\n  const el = window.document.createElementNS(namespaceURI, tagName);\n  return el;\n};\n\nconst docStyle = window.document && window.document.documentElement.style;\n\nfunction testProp(props: any) {\n  if (!docStyle) {\n    return props[0];\n  }\n  for (const i of props) {\n    if (i in docStyle) {\n      return i;\n    }\n  }\n  return props[0];\n}\n\nconst selectProp = testProp([\n  'userSelect',\n  'MozUserSelect',\n  'WebkitUserSelect',\n  'msUserSelect',\n]);\nlet userSelect: any;\n\nDOM.disableDrag = () => {\n  if (docStyle && selectProp) {\n    userSelect = docStyle[selectProp];\n    docStyle[selectProp] = 'none';\n  }\n};\n\nDOM.enableDrag = () => {\n  if (docStyle && selectProp) {\n    docStyle[selectProp] = userSelect;\n  }\n};\n\nconst transformProp = testProp(['transform', 'WebkitTransform']);\n\nDOM.setTransform = (el: HTMLElement, value: string) => {\n  // https://github.com/facebook/flow/issues/7754\n  // $FlowFixMe\n  el.style[transformProp] = value;\n};\n\n// Feature detection for {passive: false} support in add/removeEventListener.\nlet passiveSupported = false;\n\ntry {\n  // https://github.com/facebook/flow/issues/285\n  // $FlowFixMe\n  const options = Object.defineProperty({}, 'passive', {\n    get() {\n      // eslint-disable-line\n      passiveSupported = true;\n    },\n  });\n  window.addEventListener('test', options, options);\n  window.removeEventListener('test', options, options);\n} catch (err) {\n  passiveSupported = false;\n}\n\nDOM.addEventListener = (\n  target: any,\n  type: any,\n  callback: any,\n  options: { passive?: boolean; capture?: boolean } = {},\n) => {\n  if ('passive' in options && passiveSupported) {\n    target.addEventListener(type, callback, options);\n  } else {\n    target.addEventListener(type, callback, options.capture);\n  }\n};\n\nDOM.removeEventListener = (\n  target: any,\n  type: any,\n  callback: any,\n  options: { passive?: boolean; capture?: boolean } = {},\n) => {\n  if ('passive' in options && passiveSupported) {\n    target.removeEventListener(type, callback, options);\n  } else {\n    target.removeEventListener(type, callback, options.capture);\n  }\n};\n\n// Suppress the next click, but only if it's immediate.\nconst suppressClick = (e: MouseEvent) => {\n  e.preventDefault();\n  e.stopPropagation();\n  window.removeEventListener('click', suppressClick, true);\n};\n\nDOM.suppressClick = () => {\n  window.addEventListener('click', suppressClick, true);\n  window.setTimeout(() => {\n    window.removeEventListener('click', suppressClick, true);\n  }, 0);\n};\n\nDOM.mousePos = (el: HTMLElement, e: MouseEvent | Touch) => {\n  const rect = el.getBoundingClientRect();\n  return new Point(\n    e.clientX - rect.left - el.clientLeft,\n    e.clientY - rect.top - el.clientTop,\n  );\n};\n\nDOM.touchPos = (el: HTMLElement, touches: Touch[]) => {\n  const rect = el.getBoundingClientRect();\n  const points = [];\n  for (const touche of touches) {\n    points.push(\n      new Point(\n        touche.clientX - rect.left - el.clientLeft,\n        touche.clientY - rect.top - el.clientTop,\n      ),\n    );\n  }\n  return points;\n};\n\nDOM.mouseButton = (e: MouseEvent) => {\n  if (\n    // @ts-ignore\n    typeof window.InstallTrigger !== 'undefined' &&\n    e.button === 2 &&\n    e.ctrlKey &&\n    window.navigator.platform.toUpperCase().indexOf('MAC') >= 0\n  ) {\n    // Fix for https://github.com/mapbox/mapbox-gl-js/issues/3131:\n    // Firefox (detected by InstallTrigger) on Mac determines e.button = 2 when\n    // using Control + left click\n    return 0;\n  }\n  return e.button;\n};\n\nDOM.remove = (node: HTMLElement) => {\n  if (node.parentNode) {\n    node.parentNode.removeChild(node);\n  }\n};\n"],"file":"dom.js"}