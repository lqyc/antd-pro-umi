{"version":3,"sources":["../../src/handler/box_zoom.ts"],"names":["DOM","Event","BoxZoomHandler","map","options","el","container","enabled","active","startPos","lastPos","box","clickTolerance","getCanvasContainer","getContainer","isEnabled","e","point","shiftKey","button","disableDrag","pos","equals","dist","p0","create","classList","add","fireEvent","minX","Math","min","x","maxX","max","minY","y","maxY","setTransform","style","width","height","p1","reset","suppressClick","emit","originalEvent","cameraAnimation","fitScreenCoordinates","getBearing","linear","keyCode","remove","enableDrag","type"],"mappings":";;AAGA,OAAOA,GAAP,MAAgB,cAAhB;AACA,SAASC,KAAT,QAAsB,gBAAtB;;IAMMC,c;AAcJ,0BACEC,GADF,EAEEC,OAFF,EAKE;AAAA;;AAAA,SAlBMD,GAkBN;AAAA,SAjBME,EAiBN;AAAA,SAhBMC,SAgBN;AAAA,SAfMC,OAeN;AAAA,SAdMC,MAcN;AAAA,SAbMC,QAaN;AAAA,SAZMC,OAYN;AAAA,SAXMC,GAWN;AAAA,SAVMC,cAUN;AACA,SAAKT,GAAL,GAAWA,GAAX;AACA,SAAKE,EAAL,GAAUF,GAAG,CAACU,kBAAJ,EAAV;AACA,SAAKP,SAAL,GAAiBH,GAAG,CAACW,YAAJ,EAAjB;AACA,SAAKF,cAAL,GAAsBR,OAAO,CAACQ,cAAR,IAA0B,CAAhD;AACD;;;;WAOD,qBAAmB;AACjB,aAAO,CAAC,CAAC,KAAKL,OAAd;AACD;;;WAOD,oBAAkB;AAChB,aAAO,CAAC,CAAC,KAAKC,MAAd;AACD;;;WAQD,kBAAgB;AACd,UAAI,KAAKO,SAAL,EAAJ,EAAsB;AACpB;AACD;;AACD,WAAKR,OAAL,GAAe,IAAf;AACD;;;WAQD,mBAAiB;AACf,UAAI,CAAC,KAAKQ,SAAL,EAAL,EAAuB;AACrB;AACD;;AACD,WAAKR,OAAL,GAAe,KAAf;AACD;;;WAED,mBAAiBS,CAAjB,EAAgCC,KAAhC,EAA8C;AAC5C,UAAI,CAAC,KAAKF,SAAL,EAAL,EAAuB;AACrB;AACD;;AACD,UAAI,EAAEC,CAAC,CAACE,QAAF,IAAcF,CAAC,CAACG,MAAF,KAAa,CAA7B,CAAJ,EAAqC;AACnC;AACD;;AAEDnB,MAAAA,GAAG,CAACoB,WAAJ;AACA,WAAKX,QAAL,GAAgB,KAAKC,OAAL,GAAeO,KAA/B;AACA,WAAKT,MAAL,GAAc,IAAd;AACD;;;WAED,yBAAuBQ,CAAvB,EAAsCC,KAAtC,EAAoD;AAClD,UAAI,CAAC,KAAKT,MAAV,EAAkB;AAChB;AACD;;AAED,UAAMa,GAAG,GAAGJ,KAAZ;;AAEA,UACE,KAAKP,OAAL,CAAaY,MAAb,CAAoBD,GAApB,KACC,CAAC,KAAKV,GAAN,IAAaU,GAAG,CAACE,IAAJ,CAAS,KAAKd,QAAd,IAA0B,KAAKG,cAF/C,EAGE;AACA;AACD;;AAED,UAAMY,EAAE,GAAG,KAAKf,QAAhB;AACA,WAAKC,OAAL,GAAeW,GAAf;;AAEA,UAAI,CAAC,KAAKV,GAAV,EAAe;AACb,aAAKA,GAAL,GAAWX,GAAG,CAACyB,MAAJ,CAAW,KAAX,EAAkB,YAAlB,EAAgC,KAAKnB,SAArC,CAAX;AACA,aAAKA,SAAL,CAAeoB,SAAf,CAAyBC,GAAzB,CAA6B,cAA7B;AACA,aAAKC,SAAL,CAAe,cAAf,EAA+BZ,CAA/B;AACD;;AACD,UAAMa,IAAI,GAAGC,IAAI,CAACC,GAAL,CAASP,EAAE,CAACQ,CAAZ,EAAeX,GAAG,CAACW,CAAnB,CAAb;AACA,UAAMC,IAAI,GAAGH,IAAI,CAACI,GAAL,CAASV,EAAE,CAACQ,CAAZ,EAAeX,GAAG,CAACW,CAAnB,CAAb;AACA,UAAMG,IAAI,GAAGL,IAAI,CAACC,GAAL,CAASP,EAAE,CAACY,CAAZ,EAAef,GAAG,CAACe,CAAnB,CAAb;AACA,UAAMC,IAAI,GAAGP,IAAI,CAACI,GAAL,CAASV,EAAE,CAACY,CAAZ,EAAef,GAAG,CAACe,CAAnB,CAAb;AAEApC,MAAAA,GAAG,CAACsC,YAAJ,CAAiB,KAAK3B,GAAtB,sBAAwCkB,IAAxC,gBAAkDM,IAAlD;;AACA,UAAI,KAAKxB,GAAT,EAAc;AACZ,aAAKA,GAAL,CAAS4B,KAAT,CAAeC,KAAf,aAA0BP,IAAI,GAAGJ,IAAjC;AACA,aAAKlB,GAAL,CAAS4B,KAAT,CAAeE,MAAf,aAA2BJ,IAAI,GAAGF,IAAlC;AACD;AACF;;;WAED,uBAAqBnB,CAArB,EAAoCC,KAApC,EAAkD;AAAA;;AAChD,UAAI,CAAC,KAAKT,MAAV,EAAkB;AAChB;AACD;;AAED,UAAIQ,CAAC,CAACG,MAAF,KAAa,CAAjB,EAAoB;AAClB;AACD;;AAED,UAAMK,EAAE,GAAG,KAAKf,QAAhB;AACA,UAAMiC,EAAE,GAAGzB,KAAX;AAEA,WAAK0B,KAAL;AAEA3C,MAAAA,GAAG,CAAC4C,aAAJ;;AAEA,UAAIpB,EAAE,CAACQ,CAAH,KAASU,EAAE,CAACV,CAAZ,IAAiBR,EAAE,CAACY,CAAH,KAASM,EAAE,CAACN,CAAjC,EAAoC;AAClC,aAAKR,SAAL,CAAe,eAAf,EAAgCZ,CAAhC;AACD,OAFD,MAEO;AACL,aAAKb,GAAL,CAAS0C,IAAT,CACE,YADF,EAEE,IAAI5C,KAAJ,CAAU,YAAV,EAAwB;AAAE6C,UAAAA,aAAa,EAAE9B;AAAjB,SAAxB,CAFF;AAIA,eAAO;AACL+B,UAAAA,eAAe,EAAE,yBAAC5C,GAAD;AAAA,mBACfA,GAAG,CAAC6C,oBAAJ,CAAyBxB,EAAzB,EAA6BkB,EAA7B,EAAiC,KAAI,CAACvC,GAAL,CAAS8C,UAAT,EAAjC,EAAwD;AACtDC,cAAAA,MAAM,EAAE;AAD8C,aAAxD,CADe;AAAA;AADZ,SAAP;AAMD;AACF;;;WAED,iBAAelC,CAAf,EAAiC;AAC/B,UAAI,CAAC,KAAKR,MAAV,EAAkB;AAChB;AACD;;AAED,UAAIQ,CAAC,CAACmC,OAAF,KAAc,EAAlB,EAAsB;AACpB,aAAKR,KAAL;AACA,aAAKf,SAAL,CAAe,eAAf,EAAgCZ,CAAhC;AACD;AACF;;;WAED,iBAAe;AACb,WAAKR,MAAL,GAAc,KAAd;AAEA,WAAKF,SAAL,CAAeoB,SAAf,CAAyB0B,MAAzB,CAAgC,cAAhC;;AAEA,UAAI,KAAKzC,GAAT,EAAc;AACZX,QAAAA,GAAG,CAACoD,MAAJ,CAAW,KAAKzC,GAAhB;AACA,aAAKA,GAAL,GAAW,IAAX;AACD;;AAEDX,MAAAA,GAAG,CAACqD,UAAJ;AAEA,aAAO,KAAK5C,QAAZ;AACA,aAAO,KAAKC,OAAZ;AACD;;;WAED,mBAAiB4C,IAAjB,EAA+BtC,CAA/B,EAAuC;AACrC,aAAO,KAAKb,GAAL,CAAS0C,IAAT,CAAcS,IAAd,EAAoB,IAAIrD,KAAJ,CAAUqD,IAAV,EAAgB;AAAER,QAAAA,aAAa,EAAE9B;AAAjB,OAAhB,CAApB,CAAP;AACD;;;;;;AAGH,eAAed,cAAf","sourcesContent":["// @ts-ignore\nimport Point from '../geo/point';\nimport { Map } from '../map';\nimport DOM from '../utils/dom';\nimport { Event } from './events/event';\n\n/**\n * The `BoxZoomHandler` allows the user to zoom the map to fit within a bounding box.\n * The bounding box is defined by clicking and holding `shift` while dragging the cursor.\n */\nclass BoxZoomHandler {\n  private map: Map;\n  private el: HTMLElement;\n  private container: HTMLElement;\n  private enabled: boolean;\n  private active: boolean;\n  private startPos: Point;\n  private lastPos: Point;\n  private box: HTMLElement | null;\n  private clickTolerance: number;\n\n  /**\n   * @private\n   */\n  constructor(\n    map: Map,\n    options: {\n      clickTolerance: number;\n    },\n  ) {\n    this.map = map;\n    this.el = map.getCanvasContainer();\n    this.container = map.getContainer();\n    this.clickTolerance = options.clickTolerance || 1;\n  }\n\n  /**\n   * Returns a Boolean indicating whether the \"box zoom\" interaction is enabled.\n   *\n   * @returns {boolean} `true` if the \"box zoom\" interaction is enabled.\n   */\n  public isEnabled() {\n    return !!this.enabled;\n  }\n\n  /**\n   * Returns a Boolean indicating whether the \"box zoom\" interaction is active, i.e. currently being used.\n   *\n   * @returns {boolean} `true` if the \"box zoom\" interaction is active.\n   */\n  public isActive() {\n    return !!this.active;\n  }\n\n  /**\n   * Enables the \"box zoom\" interaction.\n   *\n   * @example\n   *   map.boxZoom.enable();\n   */\n  public enable() {\n    if (this.isEnabled()) {\n      return;\n    }\n    this.enabled = true;\n  }\n\n  /**\n   * Disables the \"box zoom\" interaction.\n   *\n   * @example\n   *   map.boxZoom.disable();\n   */\n  public disable() {\n    if (!this.isEnabled()) {\n      return;\n    }\n    this.enabled = false;\n  }\n\n  public mousedown(e: MouseEvent, point: Point) {\n    if (!this.isEnabled()) {\n      return;\n    }\n    if (!(e.shiftKey && e.button === 0)) {\n      return;\n    }\n\n    DOM.disableDrag();\n    this.startPos = this.lastPos = point;\n    this.active = true;\n  }\n\n  public mousemoveWindow(e: MouseEvent, point: Point) {\n    if (!this.active) {\n      return;\n    }\n\n    const pos = point;\n\n    if (\n      this.lastPos.equals(pos) ||\n      (!this.box && pos.dist(this.startPos) < this.clickTolerance)\n    ) {\n      return;\n    }\n\n    const p0 = this.startPos;\n    this.lastPos = pos;\n\n    if (!this.box) {\n      this.box = DOM.create('div', 'l7-boxzoom', this.container);\n      this.container.classList.add('l7-crosshair');\n      this.fireEvent('boxzoomstart', e);\n    }\n    const minX = Math.min(p0.x, pos.x);\n    const maxX = Math.max(p0.x, pos.x);\n    const minY = Math.min(p0.y, pos.y);\n    const maxY = Math.max(p0.y, pos.y);\n\n    DOM.setTransform(this.box, `translate(${minX}px,${minY}px)`);\n    if (this.box) {\n      this.box.style.width = `${maxX - minX}px`;\n      this.box.style.height = `${maxY - minY}px`;\n    }\n  }\n\n  public mouseupWindow(e: MouseEvent, point: Point) {\n    if (!this.active) {\n      return;\n    }\n\n    if (e.button !== 0) {\n      return;\n    }\n\n    const p0 = this.startPos;\n    const p1 = point;\n\n    this.reset();\n\n    DOM.suppressClick();\n\n    if (p0.x === p1.x && p0.y === p1.y) {\n      this.fireEvent('boxzoomcancel', e);\n    } else {\n      this.map.emit(\n        'boxzoomend',\n        new Event('boxzoomend', { originalEvent: e }),\n      );\n      return {\n        cameraAnimation: (map: Map) =>\n          map.fitScreenCoordinates(p0, p1, this.map.getBearing(), {\n            linear: true,\n          }),\n      };\n    }\n  }\n\n  public keydown(e: KeyboardEvent) {\n    if (!this.active) {\n      return;\n    }\n\n    if (e.keyCode === 27) {\n      this.reset();\n      this.fireEvent('boxzoomcancel', e);\n    }\n  }\n\n  public reset() {\n    this.active = false;\n\n    this.container.classList.remove('l7-crosshair');\n\n    if (this.box) {\n      DOM.remove(this.box);\n      this.box = null;\n    }\n\n    DOM.enableDrag();\n\n    delete this.startPos;\n    delete this.lastPos;\n  }\n\n  public fireEvent(type: string, e: any) {\n    return this.map.emit(type, new Event(type, { originalEvent: e }));\n  }\n}\n\nexport default BoxZoomHandler;\n"],"file":"box_zoom.js"}