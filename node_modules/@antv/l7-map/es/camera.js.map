{"version":3,"sources":["../src/camera.ts"],"names":["EventEmitter","LngLat","LngLatBounds","Point","Transform","Event","clamp","ease","defaultEasing","interpolate","now","pick","prefersReducedMotion","wrap","Camera","options","transform","moving","zooming","rotating","pitching","padding","bearingSnap","easeEndTimeoutID","easeStart","easeOptions","easeId","onEaseFrame","onEaseEnd","easeFrameId","renderFrameCallback","t","Math","min","duration","easing","requestRenderFrame","stop","minZoom","maxZoom","minPitch","maxPitch","renderWorldCopies","cb","_","center","lng","lat","zoom","pitch","eventData","jumpTo","bearing","lnglat","easeTo","zoomTo","getZoom","rotateTo","bounds","fitInternal","cameraForBounds","convert","cameraForBoxAndBearing","getNorthWest","getSouthEast","abs","getBearing","resetNorth","tr","zoomChanged","bearingChanged","pitchChanged","undefined","isPaddingEqual","emit","offset","animate","essential","startZoom","startBearing","startPitch","getPitch","startPadding","getPadding","normalizeBearing","offsetAsPoint","pointAtOffset","centerPoint","add","locationAtOffset","pointLocation","normalizeCenter","from","project","delta","sub","finalScale","zoomScale","around","aroundPoint","locationPoint","currently","prepareEase","noMoveStart","clearTimeout","k","interpolatePadding","setLocationAtPoint","scale","base","max","speedup","pow","newCenter","unproject","mult","fireMoveEvents","interruptingEaseId","afterEase","coercedOptions","speed","curve","rho","w0","width","height","w1","u1","mag","wMax","sqrt","rho2","r","i","b","log","sinh","n","exp","cosh","tanh","r0","w","s","u","S","isFinite","V","screenSpeed","maxDuration","easeScale","scaleZoom","p0","p1","allowGestures","cancelRenderFrame","call","currentBearing","diff","lngRange","wasZooming","wasRotating","wasPitching","frame","finish","defaultPadding","top","bottom","right","left","p","edgePadding","p0world","p1world","p0rotated","rotate","PI","p1rotated","upperRight","x","y","lowerLeft","size","scaleX","scaleY","paddingOffsetX","paddingOffsetY","offsetAtInitialZoom","offsetAtFinalZoom","div","calculatedOptions","linear","flyTo"],"mappings":"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","sourcesContent":["// @ts-ignore\nimport { EventEmitter } from 'eventemitter3';\nimport { merge } from 'lodash';\nimport { IPaddingOptions } from './geo/edge_insets';\nimport LngLat, { LngLatLike } from './geo/lng_lat';\nimport LngLatBounds, { LngLatBoundsLike } from './geo/lng_lat_bounds';\nimport Point, { PointLike } from './geo/point';\nimport Transform from './geo/transform';\nimport { Event } from './handler/events/event';\nimport { IMapOptions } from './interface';\ntype CallBack = (_: number) => void;\nimport {\n  cancel,\n  clamp,\n  ease as defaultEasing,\n  interpolate,\n  now,\n  pick,\n  prefersReducedMotion,\n  raf,\n  wrap,\n} from './util';\n\nexport interface ICameraOptions {\n  center?: LngLatLike;\n  zoom?: number;\n  bearing?: number;\n  pitch?: number;\n  around?: LngLatLike;\n  padding?: IPaddingOptions;\n}\n\nexport interface IAnimationOptions {\n  duration?: number;\n  easing?: (_: number) => number;\n  offset?: PointLike;\n  animate?: boolean;\n  essential?: boolean;\n  linear?: boolean;\n}\n\nexport default class Camera extends EventEmitter {\n  public transform: Transform;\n  // public requestRenderFrame: (_: any) => number;\n  // public cancelRenderFrame: (_: number) => void;\n  protected options: IMapOptions;\n  protected moving: boolean;\n  protected zooming: boolean;\n  protected rotating: boolean;\n  protected pitching: boolean;\n  protected padding: boolean;\n\n  private bearingSnap: number;\n  private easeEndTimeoutID: number;\n  private easeStart: number;\n  private easeOptions: {\n    duration: number;\n    easing: (_: number) => number;\n  };\n  private easeId: string | void;\n  private onEaseFrame: (_: number) => void;\n  private onEaseEnd: (easeId?: string) => void;\n  private easeFrameId: number;\n\n  constructor(options: IMapOptions) {\n    super();\n    this.options = options;\n    const { minZoom, maxZoom, minPitch, maxPitch, renderWorldCopies } = options;\n    this.moving = false;\n    this.zooming = false;\n    this.bearingSnap = options.bearingSnap;\n    this.transform = new Transform(\n      minZoom,\n      maxZoom,\n      minPitch,\n      maxPitch,\n      renderWorldCopies,\n    );\n  }\n  public requestRenderFrame(cb: CallBack): number {\n    return 0;\n  }\n  public cancelRenderFrame(_: number): void {\n    return;\n  }\n\n  public getCenter() {\n    const { lng, lat } = this.transform.center;\n    return new LngLat(lng, lat);\n  }\n\n  public getZoom(): number {\n    return this.transform.zoom;\n  }\n\n  public getPitch(): number {\n    return this.transform.pitch;\n  }\n\n  public setCenter(center: LngLatLike, eventData?: any) {\n    return this.jumpTo({ center }, eventData);\n  }\n\n  public setPitch(pitch: number, eventData?: any) {\n    this.jumpTo({ pitch }, eventData);\n    return this;\n  }\n\n  public getBearing(): number {\n    return this.transform.bearing;\n  }\n\n  public panTo(\n    lnglat: LngLatLike,\n    options?: IAnimationOptions,\n    eventData?: any,\n  ) {\n    return this.easeTo(\n      merge(\n        {\n          center: lnglat,\n        },\n        options,\n      ),\n      eventData,\n    );\n  }\n\n  public zoomOut(options?: IAnimationOptions, eventData?: any) {\n    this.zoomTo(this.getZoom() - 1, options, eventData);\n    return this;\n  }\n\n  public setBearing(bearing: number, eventData?: any) {\n    this.jumpTo({ bearing }, eventData);\n    return this;\n  }\n  public setZoom(zoom: number, eventData?: any) {\n    this.jumpTo({ zoom }, eventData);\n    return this;\n  }\n\n  public zoomIn(options?: IAnimationOptions, eventData?: any) {\n    this.zoomTo(this.getZoom() + 1, options, eventData);\n    return this;\n  }\n\n  public zoomTo(zoom: number, options?: IAnimationOptions, eventData?: any) {\n    return this.easeTo(\n      merge(\n        {\n          zoom,\n        },\n        options,\n      ),\n      eventData,\n    );\n  }\n\n  public getPadding(): IPaddingOptions {\n    return this.transform.padding;\n  }\n\n  public setPadding(padding: IPaddingOptions, eventData?: any) {\n    this.jumpTo({ padding }, eventData);\n    return this;\n  }\n\n  public rotateTo(\n    bearing: number,\n    options?: IAnimationOptions,\n    eventData?: any,\n  ) {\n    return this.easeTo(\n      merge(\n        {\n          bearing,\n        },\n        options,\n      ),\n      eventData,\n    );\n  }\n\n  public resetNorth(options?: IAnimationOptions, eventData?: any) {\n    this.rotateTo(0, merge({ duration: 1000 }, options), eventData);\n    return this;\n  }\n\n  public resetNorthPitch(options?: IAnimationOptions, eventData?: any) {\n    this.easeTo(\n      merge(\n        {\n          bearing: 0,\n          pitch: 0,\n          duration: 1000,\n        },\n        options,\n      ),\n      eventData,\n    );\n    return this;\n  }\n  public fitBounds(\n    bounds: LngLatBoundsLike,\n    options?: IAnimationOptions & ICameraOptions,\n    eventData?: any,\n  ) {\n    return this.fitInternal(\n      // @ts-ignore\n      this.cameraForBounds(bounds, options),\n      options,\n      eventData,\n    );\n  }\n  public cameraForBounds(\n    bounds: LngLatBoundsLike,\n    options?: ICameraOptions,\n  ): void | (ICameraOptions & IAnimationOptions) {\n    bounds = LngLatBounds.convert(bounds);\n    return this.cameraForBoxAndBearing(\n      bounds.getNorthWest(),\n      bounds.getSouthEast(),\n      0,\n      // @ts-ignore\n      options,\n    );\n  }\n\n  public snapToNorth(options?: IAnimationOptions, eventData?: any) {\n    if (Math.abs(this.getBearing()) < this.bearingSnap) {\n      return this.resetNorth(options, eventData);\n    }\n    return this;\n  }\n\n  public jumpTo(options: ICameraOptions = {}, eventData?: any) {\n    this.stop();\n\n    const tr = this.transform;\n    let zoomChanged = false;\n    let bearingChanged = false;\n    let pitchChanged = false;\n\n    if (options.zoom && tr.zoom !== +options.zoom) {\n      zoomChanged = true;\n      tr.zoom = +options.zoom;\n    }\n\n    if (options.center !== undefined) {\n      tr.center = LngLat.convert(options.center);\n    }\n\n    if (options.bearing && tr.bearing !== +options.bearing) {\n      bearingChanged = true;\n      tr.bearing = +options.bearing;\n    }\n\n    if (options.pitch && tr.pitch !== +options.pitch) {\n      pitchChanged = true;\n      tr.pitch = +options.pitch;\n    }\n\n    if (options.padding != null && !tr.isPaddingEqual(options.padding)) {\n      tr.padding = options.padding;\n    }\n\n    this.emit('movestart', new Event('movestart', eventData));\n    this.emit('move', new Event('move', eventData));\n\n    if (zoomChanged) {\n      this.emit('zoomstart', new Event('zoomstart', eventData));\n      this.emit('zoom', new Event('zoom', eventData));\n      this.emit('zoomend', new Event('zoomend', eventData));\n    }\n\n    if (bearingChanged) {\n      this.emit('rotatestart', new Event('rotatestart', eventData));\n      this.emit('rotate', new Event('rotate', eventData));\n      this.emit('rotateend', new Event('rotateend', eventData));\n    }\n\n    if (pitchChanged) {\n      this.emit('pitchstart', new Event('pitchstart', eventData));\n      this.emit('pitch', new Event('pitch', eventData));\n      this.emit('pitchend', new Event('pitchend', eventData));\n    }\n\n    return this.emit('moveend', new Event('moveend', eventData));\n  }\n\n  public easeTo(\n    options: ICameraOptions &\n      IAnimationOptions & { easeId?: string; noMoveStart?: boolean } = {},\n    eventData?: any,\n  ) {\n    options = merge(\n      {\n        offset: [0, 0],\n        duration: 500,\n        easing: defaultEasing,\n      },\n      options,\n    );\n\n    if (\n      options.animate === false ||\n      (!options.essential && prefersReducedMotion())\n    ) {\n      options.duration = 0;\n    }\n\n    const tr = this.transform;\n    const startZoom = this.getZoom();\n    const startBearing = this.getBearing();\n    const startPitch = this.getPitch();\n    const startPadding = this.getPadding();\n\n    const zoom = options.zoom ? +options.zoom : startZoom;\n    const bearing = options.bearing\n      ? this.normalizeBearing(options.bearing, startBearing)\n      : startBearing;\n    const pitch = options.pitch ? +options.pitch : startPitch;\n    const padding = options.padding ? options.padding : tr.padding;\n\n    const offsetAsPoint = Point.convert(options.offset);\n    let pointAtOffset = tr.centerPoint.add(offsetAsPoint);\n    const locationAtOffset = tr.pointLocation(pointAtOffset);\n    const center = LngLat.convert(options.center || locationAtOffset);\n    this.normalizeCenter(center);\n\n    const from = tr.project(locationAtOffset);\n    const delta = tr.project(center).sub(from);\n    const finalScale = tr.zoomScale(zoom - startZoom);\n\n    let around: LngLat;\n    let aroundPoint: Point;\n\n    if (options.around) {\n      around = LngLat.convert(options.around);\n      aroundPoint = tr.locationPoint(around);\n    }\n\n    const currently = {\n      moving: this.moving,\n      zooming: this.zooming,\n      rotating: this.rotating,\n      pitching: this.pitching,\n    };\n\n    this.zooming = this.zooming || zoom !== startZoom;\n    this.rotating = this.rotating || startBearing !== bearing;\n    this.pitching = this.pitching || pitch !== startPitch;\n    this.padding = !tr.isPaddingEqual(padding);\n\n    this.easeId = options.easeId;\n    this.prepareEase(eventData, options.noMoveStart, currently);\n\n    clearTimeout(this.easeEndTimeoutID);\n\n    this.ease(\n      (k) => {\n        if (this.zooming) {\n          tr.zoom = interpolate(startZoom, zoom, k);\n        }\n        if (this.rotating) {\n          tr.bearing = interpolate(startBearing, bearing, k);\n        }\n        if (this.pitching) {\n          tr.pitch = interpolate(startPitch, pitch, k);\n        }\n        if (this.padding) {\n          tr.interpolatePadding(startPadding, padding, k);\n          // When padding is being applied, Transform#centerPoint is changing continously,\n          // thus we need to recalculate offsetPoint every fra,e\n          pointAtOffset = tr.centerPoint.add(offsetAsPoint);\n        }\n\n        if (around) {\n          tr.setLocationAtPoint(around, aroundPoint);\n        } else {\n          const scale = tr.zoomScale(tr.zoom - startZoom);\n          const base =\n            zoom > startZoom\n              ? Math.min(2, finalScale)\n              : Math.max(0.5, finalScale);\n          const speedup = Math.pow(base, 1 - k);\n          const newCenter = tr.unproject(\n            from.add(delta.mult(k * speedup)).mult(scale),\n          );\n          tr.setLocationAtPoint(\n            tr.renderWorldCopies ? newCenter.wrap() : newCenter,\n            pointAtOffset,\n          );\n        }\n\n        this.fireMoveEvents(eventData);\n      },\n      (interruptingEaseId?: string) => {\n        this.afterEase(eventData, interruptingEaseId);\n      },\n      // @ts-ignore\n      options,\n    );\n\n    return this;\n  }\n  public flyTo(options: any = {}, eventData?: any) {\n    // Fall through to jumpTo if user has set prefers-reduced-motion\n    if (!options.essential && prefersReducedMotion()) {\n      const coercedOptions = pick(options, [\n        'center',\n        'zoom',\n        'bearing',\n        'pitch',\n        'around',\n      ]) as ICameraOptions;\n      return this.jumpTo(coercedOptions, eventData);\n    }\n\n    this.stop();\n\n    options = merge(\n      {\n        offset: [0, 0],\n        speed: 1.2,\n        curve: 1.42,\n        easing: defaultEasing,\n      },\n      options,\n    );\n    const tr = this.transform;\n    const startZoom = this.getZoom();\n    const startBearing = this.getBearing();\n    const startPitch = this.getPitch();\n    const startPadding = this.getPadding();\n\n    const zoom = options.zoom\n      ? clamp(+options.zoom, tr.minZoom, tr.maxZoom)\n      : startZoom;\n    const bearing = options.bearing\n      ? this.normalizeBearing(options.bearing, startBearing)\n      : startBearing;\n    const pitch = options.pitch ? +options.pitch : startPitch;\n    const padding = 'padding' in options ? options.padding : tr.padding;\n\n    const scale = tr.zoomScale(zoom - startZoom);\n    const offsetAsPoint = Point.convert(options.offset);\n    let pointAtOffset = tr.centerPoint.add(offsetAsPoint);\n    const locationAtOffset = tr.pointLocation(pointAtOffset);\n    const center = LngLat.convert(options.center || locationAtOffset);\n    this.normalizeCenter(center);\n\n    const from = tr.project(locationAtOffset);\n    const delta = tr.project(center).sub(from);\n\n    let rho = options.curve;\n\n    // w₀: Initial visible span, measured in pixels at the initial scale.\n    const w0 = Math.max(tr.width, tr.height);\n    // w₁: Final visible span, measured in pixels with respect to the initial scale.\n    const w1 = w0 / scale;\n    // Length of the flight path as projected onto the ground plane, measured in pixels from\n    // the world image origin at the initial scale.\n    const u1 = delta.mag();\n\n    if ('minZoom' in options) {\n      const minZoom = clamp(\n        Math.min(options.minZoom, startZoom, zoom),\n        tr.minZoom,\n        tr.maxZoom,\n      );\n      // w<sub>m</sub>: Maximum visible span, measured in pixels with respect to the initial\n      // scale.\n      const wMax = w0 / tr.zoomScale(minZoom - startZoom);\n      rho = Math.sqrt((wMax / u1) * 2);\n    }\n\n    // ρ²\n    const rho2 = rho * rho;\n\n    /**\n     * rᵢ: Returns the zoom-out factor at one end of the animation.\n     *\n     * @param i 0 for the ascent or 1 for the descent.\n     * @private\n     */\n    function r(i: number) {\n      const b =\n        (w1 * w1 - w0 * w0 + (i ? -1 : 1) * rho2 * rho2 * u1 * u1) /\n        (2 * (i ? w1 : w0) * rho2 * u1);\n      return Math.log(Math.sqrt(b * b + 1) - b);\n    }\n\n    function sinh(n: number) {\n      return (Math.exp(n) - Math.exp(-n)) / 2;\n    }\n    function cosh(n: number) {\n      return (Math.exp(n) + Math.exp(-n)) / 2;\n    }\n    function tanh(n: number) {\n      return sinh(n) / cosh(n);\n    }\n\n    // r₀: Zoom-out factor during ascent.\n    const r0 = r(0);\n\n    // w(s): Returns the visible span on the ground, measured in pixels with respect to the\n    // initial scale. Assumes an angular field of view of 2 arctan ½ ≈ 53°.\n    let w: (_: number) => number = (s) => {\n      return cosh(r0) / cosh(r0 + rho * s);\n    };\n\n    // u(s): Returns the distance along the flight path as projected onto the ground plane,\n    // measured in pixels from the world image origin at the initial scale.\n    let u: (_: number) => number = (s) => {\n      return (w0 * ((cosh(r0) * tanh(r0 + rho * s) - sinh(r0)) / rho2)) / u1;\n    };\n\n    // S: Total length of the flight path, measured in ρ-screenfuls.\n    let S = (r(1) - r0) / rho;\n\n    // When u₀ = u₁, the optimal path doesn’t require both ascent and descent.\n    if (Math.abs(u1) < 0.000001 || !isFinite(S)) {\n      // Perform a more or less instantaneous transition if the path is too short.\n      if (Math.abs(w0 - w1) < 0.000001) {\n        return this.easeTo(options, eventData);\n      }\n\n      const k = w1 < w0 ? -1 : 1;\n      S = Math.abs(Math.log(w1 / w0)) / rho;\n\n      u = () => {\n        return 0;\n      };\n      w = (s) => {\n        return Math.exp(k * rho * s);\n      };\n    }\n\n    if ('duration' in options) {\n      options.duration = +options.duration;\n    } else {\n      const V =\n        'screenSpeed' in options ? +options.screenSpeed / rho : +options.speed;\n      options.duration = (1000 * S) / V;\n    }\n\n    if (options.maxDuration && options.duration > options.maxDuration) {\n      options.duration = 0;\n    }\n\n    this.zooming = true;\n    this.rotating = startBearing !== bearing;\n    this.pitching = pitch !== startPitch;\n    this.padding = !tr.isPaddingEqual(padding);\n\n    this.prepareEase(eventData, false);\n\n    this.ease(\n      (k) => {\n        // s: The distance traveled along the flight path, measured in ρ-screenfuls.\n        const s = k * S;\n        // @ts-ignore\n        const easeScale = 1 / w(s);\n        tr.zoom = k === 1 ? zoom : startZoom + tr.scaleZoom(easeScale);\n\n        if (this.rotating) {\n          tr.bearing = interpolate(startBearing, bearing, k);\n        }\n        if (this.pitching) {\n          tr.pitch = interpolate(startPitch, pitch, k);\n        }\n        if (this.padding) {\n          tr.interpolatePadding(startPadding, padding, k);\n          // When padding is being applied, Transform#centerPoint is changing continously,\n          // thus we need to recalculate offsetPoint every frame\n          pointAtOffset = tr.centerPoint.add(offsetAsPoint);\n        }\n\n        const newCenter =\n          k === 1\n            ? center\n            : tr.unproject(from.add(delta.mult(u(s))).mult(easeScale));\n        tr.setLocationAtPoint(\n          tr.renderWorldCopies ? newCenter.wrap() : newCenter,\n          pointAtOffset,\n        );\n\n        this.fireMoveEvents(eventData);\n      },\n      () => this.afterEase(eventData),\n      options,\n    );\n\n    return this;\n  }\n  public fitScreenCoordinates(\n    p0: PointLike,\n    p1: PointLike,\n    bearing: number,\n    options?: IAnimationOptions & ICameraOptions,\n    eventData?: any,\n  ) {\n    return this.fitInternal(\n      // @ts-ignore\n      this.cameraForBoxAndBearing(\n        this.transform.pointLocation(Point.convert(p0)),\n        this.transform.pointLocation(Point.convert(p1)),\n        bearing,\n        // @ts-ignore\n        options,\n      ),\n      options,\n      eventData,\n    );\n  }\n  public stop(allowGestures?: boolean, easeId?: string) {\n    if (this.easeFrameId) {\n      this.cancelRenderFrame(this.easeFrameId);\n      delete this.easeFrameId;\n      delete this.onEaseFrame;\n    }\n\n    if (this.onEaseEnd) {\n      // The _onEaseEnd function might emit events which trigger new\n      // animation, which sets a new _onEaseEnd. Ensure we don't delete\n      // it unintentionally.\n      const onEaseEnd = this.onEaseEnd;\n      delete this.onEaseEnd;\n      onEaseEnd.call(this, easeId);\n    }\n    // if (!allowGestures) {\n    //     const handlers = (this: any).handlers;\n    //     if (handlers) handlers.stop();\n    // }\n    return this;\n  }\n  public renderFrameCallback = () => {\n    const t = Math.min((now() - this.easeStart) / this.easeOptions.duration, 1);\n    this.onEaseFrame(this.easeOptions.easing(t));\n    if (t < 1) {\n      // this.easeFrameId = window.requestAnimationFrame(this.renderFrameCallback);\n      this.easeFrameId = this.requestRenderFrame(this.renderFrameCallback);\n    } else {\n      this.stop();\n    }\n  };\n  private normalizeBearing(bearing: number, currentBearing: number) {\n    bearing = wrap(bearing, -180, 180);\n    const diff = Math.abs(bearing - currentBearing);\n    if (Math.abs(bearing - 360 - currentBearing) < diff) {\n      bearing -= 360;\n    }\n    if (Math.abs(bearing + 360 - currentBearing) < diff) {\n      bearing += 360;\n    }\n    return bearing;\n  }\n\n  private normalizeCenter(center: LngLat) {\n    const tr = this.transform;\n    if (!tr.renderWorldCopies || tr.lngRange) {\n      return;\n    }\n\n    const delta = center.lng - tr.center.lng;\n    center.lng += delta > 180 ? -360 : delta < -180 ? 360 : 0;\n  }\n\n  private fireMoveEvents(eventData?: any) {\n    this.emit('move', new Event('move', eventData));\n    if (this.zooming) {\n      this.emit('zoom', new Event('zoom', eventData));\n    }\n    if (this.rotating) {\n      this.emit('rotate', new Event('rotate', eventData));\n    }\n    if (this.pitching) {\n      this.emit('rotate', new Event('pitch', eventData));\n    }\n  }\n  private prepareEase(\n    eventData: object | undefined,\n    noMoveStart: boolean = false,\n    currently: { [key: string]: boolean } = {},\n  ) {\n    this.moving = true;\n\n    if (!noMoveStart && !currently.moving) {\n      this.emit('movestart', new Event('movestart', eventData));\n    }\n    if (this.zooming && !currently.zooming) {\n      this.emit('zoomstart', new Event('zoomstart', eventData));\n    }\n    if (this.rotating && !currently.rotating) {\n      this.emit('rotatestart', new Event('rotatestart', eventData));\n    }\n    if (this.pitching && !currently.pitching) {\n      this.emit('pitchstart', new Event('pitchstart', eventData));\n    }\n  }\n\n  private afterEase(eventData: object | undefined, easeId?: string) {\n    // if this easing is being stopped to start another easing with\n    // the same id then don't fire any events to avoid extra start/stop events\n    if (this.easeId && easeId && this.easeId === easeId) {\n      return;\n    }\n    delete this.easeId;\n\n    const wasZooming = this.zooming;\n    const wasRotating = this.rotating;\n    const wasPitching = this.pitching;\n    this.moving = false;\n    this.zooming = false;\n    this.rotating = false;\n    this.pitching = false;\n    this.padding = false;\n\n    if (wasZooming) {\n      this.emit('zoomend', new Event('zoomend', eventData));\n    }\n    if (wasRotating) {\n      this.emit('rotateend', new Event('rotateend', eventData));\n    }\n    if (wasPitching) {\n      this.emit('pitchend', new Event('pitchend', eventData));\n    }\n    this.emit('moveend', new Event('moveend', eventData));\n  }\n\n  private ease(\n    frame: (_: number) => void,\n    finish: () => void,\n    options: {\n      animate: boolean;\n      duration: number;\n      easing: (_: number) => number;\n    },\n  ) {\n    if (options.animate === false || options.duration === 0) {\n      frame(1);\n      finish();\n    } else {\n      this.easeStart = now();\n      this.easeOptions = options;\n      this.onEaseFrame = frame;\n      this.onEaseEnd = finish;\n      this.easeFrameId = this.requestRenderFrame(this.renderFrameCallback);\n    }\n  }\n\n  private cameraForBoxAndBearing(\n    p0: LngLatLike,\n    p1: LngLatLike,\n    bearing: number,\n    options?: ICameraOptions & {\n      offset: [number, number];\n      maxZoom: number;\n      padding: IPaddingOptions;\n    },\n  ): void | (ICameraOptions & IAnimationOptions) {\n    const defaultPadding = {\n      top: 0,\n      bottom: 0,\n      right: 0,\n      left: 0,\n    };\n    options = merge(\n      {\n        padding: defaultPadding,\n        offset: [0, 0],\n        maxZoom: this.transform.maxZoom,\n      },\n      options,\n    );\n\n    if (typeof options.padding === 'number') {\n      const p = options.padding;\n      options.padding = {\n        top: p,\n        bottom: p,\n        right: p,\n        left: p,\n      };\n    }\n\n    options.padding = merge(defaultPadding, options.padding);\n    const tr = this.transform;\n    const edgePadding = tr.padding as IPaddingOptions;\n\n    // We want to calculate the upper right and lower left of the box defined by p0 and p1\n    // in a coordinate system rotate to match the destination bearing.\n    const p0world = tr.project(LngLat.convert(p0));\n    const p1world = tr.project(LngLat.convert(p1));\n    const p0rotated = p0world.rotate((-bearing * Math.PI) / 180);\n    const p1rotated = p1world.rotate((-bearing * Math.PI) / 180);\n\n    const upperRight = new Point(\n      Math.max(p0rotated.x, p1rotated.x),\n      Math.max(p0rotated.y, p1rotated.y),\n    );\n    const lowerLeft = new Point(\n      Math.min(p0rotated.x, p1rotated.x),\n      Math.min(p0rotated.y, p1rotated.y),\n    );\n\n    // Calculate zoom: consider the original bbox and padding.\n    const size = upperRight.sub(lowerLeft);\n    const scaleX =\n      (tr.width -\n        // @ts-ignore\n        (edgePadding.left +\n          // @ts-ignore\n          edgePadding.right +\n          // @ts-ignore\n          options.padding.left +\n          // @ts-ignore\n          options.padding.right)) /\n      size.x;\n    const scaleY =\n      (tr.height -\n        // @ts-ignore\n        (edgePadding.top +\n          // @ts-ignore\n          edgePadding.bottom +\n          // @ts-ignore\n          options.padding.top +\n          // @ts-ignore\n          options.padding.bottom)) /\n      size.y;\n\n    if (scaleY < 0 || scaleX < 0) {\n      return;\n    }\n\n    const zoom = Math.min(\n      tr.scaleZoom(tr.scale * Math.min(scaleX, scaleY)),\n      options.maxZoom,\n    );\n\n    // Calculate center: apply the zoom, the configured offset, as well as offset that exists as a result of padding.\n    const offset = Point.convert(options.offset);\n    // @ts-ignore\n    const paddingOffsetX = (options.padding.left - options.padding.right) / 2;\n    // @ts-ignore\n    const paddingOffsetY = (options.padding.top - options.padding.bottom) / 2;\n    const offsetAtInitialZoom = new Point(\n      offset.x + paddingOffsetX,\n      offset.y + paddingOffsetY,\n    );\n    const offsetAtFinalZoom = offsetAtInitialZoom.mult(\n      tr.scale / tr.zoomScale(zoom),\n    );\n\n    const center = tr.unproject(\n      p0world\n        .add(p1world)\n        .div(2)\n        .sub(offsetAtFinalZoom),\n    );\n\n    return {\n      center,\n      zoom,\n      bearing,\n    };\n  }\n\n  private fitInternal(\n    calculatedOptions?: ICameraOptions & IAnimationOptions,\n    options?: IAnimationOptions & ICameraOptions,\n    eventData?: any,\n  ) {\n    // cameraForBounds warns + returns undefined if unable to fit:\n    if (!calculatedOptions) {\n      return this;\n    }\n\n    options = merge(calculatedOptions, options);\n    // Explictly remove the padding field because, calculatedOptions already accounts for padding by setting zoom and center accordingly.\n    delete options.padding;\n    // @ts-ignore\n    return options.linear\n      ? this.easeTo(options, eventData)\n      : this.flyTo(options, eventData);\n  }\n}\n"],"file":"camera.js"}